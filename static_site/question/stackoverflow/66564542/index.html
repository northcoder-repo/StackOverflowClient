<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>Datatable is considering custom attribute data while search</title>
  <link rel="stylesheet" type="text/css" href="/css/base.css">
  <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
            TeX: {
            extensions: ["begingroup.js"],
            noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
            Macros: { href: "{}" }
            },
            messageStyle: "none",
            styles: { ".MathJax_Display, .MathJax_Preview, .MathJax_Preview > *": { "background": "inherit" } },
            SEEditor: "mathjaxEditing"
            });
        </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full"></script>
 </head>
 <body>
  <div class="question">
   <a href="/questions">All Questions</a>
   <h2>Datatable is considering custom attribute data while search</h2>
   <div class="container-metadata">
    <div>
     <span>Score: </span> <span>0</span>
    </div>
    <div>
     <span>Asker: </span> <span>Varinder</span>
    </div>
    <div>
     <span>Asked: </span> <span>10 Mar 2021 at 12:12</span>
    </div>
    <div>
     <a href="https://stackoverflow.com/questions/66564542/datatable-is-considering-custom-attribute-data-while-search">source</a>
    </div>
   </div>
   <div>
    <p>I am using searching Datatable's search feature. But while searching it is considering data which I have added to onclick's event parameter like below.</p>
    <pre><code>onclick="GetStaffProfileFieldsHTMLForEditing(199,'smith, 1aaliya','3/10/2021 at 05:46 AM  CST&lt;br/&gt; by Test, DATA2','3/10/2021 at 05:46 AM  CST&lt;br/&gt; by Test, DATA2')"
</code></pre>
    <p>When I search for Data2 then it shows this record which is not visible in any column of data table.</p>
    <p>Even if I use custom attribute like below even then search is not working</p>
    <pre><code>user-madeChange='Data2, Test'
</code></pre>
    <p>How can I bypass this while searching?</p>
    <p><strong>Updated 1</strong></p>
    <p>Here is the url for testing</p>
    <p><a href="https://jsfiddle.net/vr2011/psdnyvmf/8/" rel="nofollow noreferrer">JSFiddle</a></p>
    <p>If searched for <strong>Live 3, Live L 3</strong> staff then it filters but when searched for staff <strong>Test Staff</strong> then it not filtering because both have this staff. One has in column and second have in its click method</p>
   </div>
   <div class="tags">
    <span class="tag">jquery</span><span class="tag">datatables</span>
   </div>
   <hr>
   <div class="comment">
    <table>
     <tbody>
      <tr>
       <td></td>
       <td><span>If this is a <a href="https://datatables.net/" rel="nofollow noreferrer">DataTables</a> question, then you can <a href="https://stackoverflow.com/posts/66564542/edit">edit</a> your question to use the <code>datatables</code> tag, instead of using <code>datatable</code>.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">10 Mar 2021 at 13:35</span></td>
      </tr>
      <tr>
       <td>1</td>
       <td><span>Please provide a <a href="https://stackoverflow.com/help/minimal-reproducible-example">minimal reproducible example</a> that demonstrates your issue. What is shown is far too limited to try to help without a lot more code context</span> <span> - </span> <span class="display-name">charlietfl</span> <span> </span> <span class="date">10 Mar 2021 at 13:40</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span><a href="https://meta.stackoverflow.com/questions/285551/why-not-upload-images-of-code-errors-when-asking-a-question">Why not upload images of code/errors when asking a question?</a></span> <span> - </span> <span class="display-name">charlietfl</span> <span> </span> <span class="date">10 Mar 2021 at 13:45</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>When I search for the term <code>test staff</code> using your fiddle, I see one row of data.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">10 Mar 2021 at 14:48</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>@andrewjames. Yes it is working for Test Staff. But if I search for only Test only then it is not filtering. It is showing both Live 3 and Test Staff although Live 3 don't have test keyword.</span> <span> - </span> <span class="display-name">Varinder</span> <span> </span> <span class="date">11 Mar 2021 at 10:20</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Thank you for the clarification. The <code>test</code> keyword <i>does</i> exist in both rows. It's in the row displaying <code>Test Staff</code> and it's in the other row as part of the second <code>&lt;a&gt;</code> link in the "Action" column: <code>by Test, DATA2</code>. There are various unusual attributes inside that opening <code>&lt;a&gt;</code> element. Why are they there? Are they supposed to be the visible text of the link? If so, the HTML was not constructed correctly.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">11 Mar 2021 at 13:21</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Yes these extra attributes are needed. HTML was not constructed means?</span> <span> - </span> <span class="display-name">Varinder</span> <span> </span> <span class="date">11 Mar 2021 at 16:16</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>I honestly don't know if it's correct or not (I should not make assumptions). Look at the final <code>&lt;a&gt;</code> tag in your fiddle. It contains a custom HTML5 <code>data-content</code> attribute. And that attribute contains some regular HTML markup: <code>"&lt;p&gt;&lt;i&gt;Last Modified:&lt;/i&gt;&lt;/br&gt;3/10/2021 at 06:13 AM CST&lt;br/&gt; by Test, DATA2&lt;/p&gt;"</code>. The text inside that HTML is being searched by DataTables. So, you can search for <code>cst</code>, <code>modified</code>, <code>test</code> and so on - and all those searches will find this row of data.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">11 Mar 2021 at 17:00</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>If the HTML is constructed correctly, then it sounds as if you want to make sure that text is ignored by the DataTables search function. Is that what you need? If so, then yes there is a way to do this. (But why are there links, with no visible link text?)</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">11 Mar 2021 at 17:01</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Yes I want to ignore that text while searching. can you let me know how to dot his?</span> <span> - </span> <span class="display-name">Varinder</span> <span> </span> <span class="date">12 Mar 2021 at 10:19</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>That is what my answer shows you...</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">12 Mar 2021 at 13:00</span></td>
      </tr>
     </tbody>
    </table>
   </div>
   <br>
   <div>
    <h2 id="answer_1"><span>Answer 1</span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>0</span>
     </div>
     <div>
      <span>Answerer: </span> <span>andrewJames</span>
     </div>
     <div>
      <span> Answered: </span> <span>11 Mar 2021 at 18:47</span>
     </div>
    </div>
    <div>
     <p><strong>Problem</strong></p>
     <p><em>(No new info here - this is just my summary of the problem you describe in the question.)</em></p>
     <p>The data in your fiddle is unusual (to me) because it contains an HTML5 custom attribute which contains text consisting of additional HTML code - for example, looking at the <code>data-content</code> attribute in the following element:</p>
     <pre><code>&lt;a title="" 
   data-placement="left" 
   data-html="true" 
   name="topPopover" 
   class="blue popovers" 
   data-class="top-popover" 
   data-container="body" 
   data-trigger="hover" 
   data-content="
     &lt;p&gt;
     &lt;i&gt;Last Modified:&lt;/i&gt;
     &lt;/br&gt;3/10/2021 at 06:13 AM  CST
     &lt;br/&gt; by Test, DATA2
     &lt;/p&gt;" 
   data-original-title=""&gt;
     &lt;i class="far fa-clock"&gt;&lt;/i&gt;
&lt;/a&gt;
</code></pre>
     <p>So, you have HTML tags inside an attribute. I have never seen this before - but it does appear to be valid HTML, overall.</p>
     <p>DataTables has fairly complex global filtering logic. That logic identifies the text content inside the <code>data-content</code> attribute's embedded HTML tags as "visible" for its filtering purposes.</p>
     <p>Of course, because it is inside an attribute, this data is not visible to you or me in the table - but it would be visible, if it was just regular HTML (not inside an attribute).</p>
     <p>This is why your filter using <code>test</code> finds both records in your Fiddle. In fact, all of the following pieces of "invsible" text are checked by the filter:</p>
     <pre><code>Last Modified: 3/10/2021 at 06:13 AM  CST by Test, DATA2
</code></pre>
     <p><strong>Solution</strong></p>
     <p>This assumes you are not going to re-arrange that "HTML-inside-an-attribute" situation.</p>
     <p>If you want to filter only on the data which users can see in the table, you can use DataTable's <a href="https://datatables.net/manual/data/orthogonal-data" rel="nofollow noreferrer">orthogonal data</a> functionality. This lets you store different values for each table cell:</p>
     <ul>
      <li>displayed value</li>
      <li>value used for filtering</li>
      <li>value used for sorting</li>
     </ul>
     <p>You can use a column render function to define these different values.</p>
     <pre><code>$('#stafftable').DataTable( {  
  columnDefs: [ {
    targets: "_all", 
    "render": function ( data, type, row, meta ) {
      if ( type === 'filter' ) {                
        var node = $('#stafftable').DataTable().cells(meta.row, meta.col).nodes()[0];
        return node.textContent.trim();
      } else {
        return data;
      }
    }
  } ]
} );
</code></pre>
     <p><strong>Explanation</strong></p>
     <p>Each cell is processed by the above render function as the table is being built.</p>
     <p>If the processing type is "filter" then we can prepare some data suitable for use by the DataTables global filter. This will be just the visible data. This will fix the filtering problem you are currently having.</p>
     <p>To get the visible data from each cell, we have to access the <code>&lt;td&gt;</code> node of the cell:</p>
     <pre><code>var node = $('#stafftable').DataTable().cells(meta.row, meta.col).nodes()[0];
</code></pre>
     <p>This gives us each <code>&lt;td&gt;</code> node, by using the DataTables API to first select the DataTables cell, and then access the cell's node.</p>
     <p>Once we have the node, we can use the JavaScript <code>textContent</code> property to get the visible text portions of the contents: in other words, all the HTML markup is discarded - and only the displayable text is kept. This means all of that nested <code>data-content</code> HTML is also discarded.</p>
     <p>If the <code>render</code> function is not building filter data, then we just use <code>return data</code> - which is the full contents of the node (all of the HTML inside of the <code>&lt;td&gt;</code> element).</p>
     <p>This means all of that data which was discarded for filtering purposes is still in the HTML table - it has not been lost. I assume you still need it for downstream processing.</p>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <br>
   <div>
    <span>License: </span> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <span>by </span> <a href="https://stackoverflow.com/legal/terms-of-service#licensing">Stack Overflow Inc.</a>
   </div>
  </div>
 </body>
</html>