<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sending JSON to datatables giving me parameter error</title>
  <link rel="stylesheet" type="text/css" href="/css/base.css">
  <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
            TeX: {
            extensions: ["begingroup.js"],
            noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
            Macros: { href: "{}" }
            },
            messageStyle: "none",
            styles: { ".MathJax_Display, .MathJax_Preview, .MathJax_Preview > *": { "background": "inherit" } },
            SEEditor: "mathjaxEditing"
            });
        </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full"></script>
 </head>
 <body>
  <div class="question">
   <a href="/questions">All Questions</a>
   <h2>Sending JSON to datatables giving me parameter error</h2>
   <div class="container-metadata">
    <div>
     <span>Score: </span> <span>0</span>
    </div>
    <div>
     <span>Asker: </span> <span>Jason Brashear</span>
    </div>
    <div>
     <span>Asked: </span> <span>27 Feb 2020 at 19:27</span>
    </div>
    <div>
     <a href="https://stackoverflow.com/questions/60440441/sending-json-to-datatables-giving-me-parameter-error">source</a>
    </div>
   </div>
   <div>
    <p>I am trying to send json data to datatables via a php VAR but I am receiving an error: DataTables warning: table id=example - Requested unknown parameter 'Item Number' for row 0, column 0. For more information about this error, please see <a href="http://datatables.net/tn/4" rel="nofollow noreferrer">http://datatables.net/tn/4</a>. Here is how my javascript looks:</p>
    <pre><code>$(document).ready(function() {
$('#example').DataTable( {
    "processing": true,
    "data": '[1,{"1":{"A":"Item Number","B":"Type","C":"Form Factor","D":"Processor","E":"Condition Code","F":"Receive Status","G":"Unit Cost","H":"Qty"},"2":{"A":"DELL VENUE 11 PRO KEYBOARD","B":"","C":"","D":"","E":"NEW","F":"Received","G":"$80.00","H":6},"3":{"A":"ELITEBOOK 820 G2","B":"Laptop","C":"","D":"i5","E":"REF","F":"Received","G":"$90.00","H":1},"4":{"A":"ELITEBOOK 840 G2","B":"Laptop","C":"","D":"i5","E":"REF","F":"Received","G":"$109.77","H":7},"5":{"A":"ELITEBOOK 850 G2","B":"Laptop","C":"","D":"i5","E":"REF","F":"Received","G":"$226.83","H":5},"6":{"A":"ELITEDESK 800 G1","B":"Desktop","C":"SFF","D":"i5","E":"REF","F":"Received","G":"$75.06","H":3},"7":{"A":"LATITUDE E5550","B":"Laptop","C":"","D":"i7","E":"REF","F":"Received","G":"$164.43","H":57},"8":{"A":"LATITUDE E6430","B":"","C":"","D":"","E":"USED","F":"Received","G":"$96.00","H":10},"9":{"A":"LATITUDE E7470","B":"Laptop","C":"","D":"i7","E":"REF","F":"Received","G":"$191.00","H":6},"10":{"A":"LG 34MU64-P","B":"","C":"","D":"","E":"REF","F":"Received","G":"$90.08","H":22},"11":{"A":"LG 34MU68-P","B":"","C":"","D":"","E":"REF","F":"Received","G":"$90.08","H":2},"12":{"A":"LG 34UB88-P","B":"","C":"","D":"","E":"REF","F":"Received","G":"$90.08","H":1},"13":{"A":"OPTIPLEX 3010","B":"Desktop","C":"TOWER","D":"PENTIUM","E":"REF","F":"Received","G":"$63.19","H":19},"14":{"A":"OPTIPLEX 3011","B":"Desktop","C":"AIO","D":"i5","E":"REF","F":"Received","G":"$185.77","H":20},"15":{"A":"OPTIPLEX 3020","B":"Desktop","C":"USFF","D":"i5","E":"REF","F":"Received","G":"$74.64","H":92},"16":{"A":"OPTIPLEX 3040","B":"Desktop","C":"USFF","D":"i5","E":"REF","F":"Received","G":"$190.91","H":8},"17":{"A":"OPTIPLEX 3050","B":"Desktop","C":"USFF","D":"i5","E":"REF","F":"Received","G":"$213.20","H":11},"18":{"A":"OPTIPLEX 3240","B":"Desktop","C":"AIO","D":"i5","E":"REF","F":"Received","G":"$293.20","H":1},"19":{"A":"OPTIPLEX 390","B":"Desktop","C":"SFF","D":"i5","E":"REF","F":"Received","G":"$35.00","H":1},"20":{"A":"OPTIPLEX 450","B":"Desktop","C":"DESKTOP","D":"PENTIUM","E":"REF","F":"Received","G":"$0.00","H":2},"21":{"A":"OPTIPLEX 5050","B":"Desktop","C":"USFF","D":"i5","E":"REF","F":"Received","G":"$314.96","H":10},"22":{"A":"OPTIPLEX 7020","B":"Desktop","C":"SFF","D":"i5","E":"REF","F":"Received","G":"$100.27","H":61},"23":{"A":"OPTIPLEX 7040","B":"Desktop","C":"USFF","D":"i7","E":"REF","F":"Received","G":"$309.96","H":21},"24":{"A":"OPTIPLEX 7440","B":"Desktop","C":"AIO","D":"i5","E":"REF","F":"Received","G":"$236.13","H":3},"25":{"A":"OPTIPLEX 790","B":"Desktop","C":"USFF","D":"i3","E":"REF","F":"Received","G":"$65.00","H":3},"26":{"A":"OPTIPLEX 9010","B":"Desktop","C":"USFF","D":"i7","E":"REF","F":"Received","G":"$92.68","H":43},"27":{"A":"OPTIPLEX 9020","B":"Desktop","C":"USFF","D":"i7","E":"REF","F":"Received","G":"$106.37","H":203},"28":{"A":"OPTIPLEX 9030","B":"Desktop","C":"AIO","D":"i7","E":"REF","F":"Received","G":"$119.73","H":206},"29":{"A":"OPTIPLEX 990","B":"Desktop","C":"","D":"i5","E":"REF","F":"Received","G":"$77.09","H":11}}]',
    "columns": [
      { data: "Item Number" },
      { data: "Type" },
      { data: "Form Factor" },
      { data: "Processor." },
      { data: "Condition Code" },
      { data: "Receive Status" },
      { data: "Unit Cost." },
      { data: "Qty" }
    ]
} );
</code></pre>
    <p>} ); The PHP code is getting the data from an XSLT and I am json encoding it.</p>
    <pre><code>    $spreadsheet = \PhpOffice\PhpSpreadsheet\IOFactory::load('reports-dropbox/inventory.xlsx');
$data = array(1,$spreadsheet-&gt;getActiveSheet()-&gt;toArray(null,true,true,true));
$json = json_encode($data);
</code></pre>
   </div>
   <div class="tags">
    <span class="tag">php</span><span class="tag">json</span><span class="tag">datatables</span>
   </div>
   <hr>
   <div class="comment">
    <table>
     <tbody>
      <tr>
       <td>1</td>
       <td><span>your <code>data</code> is not json its a string, try removing the quotes</span> <span> - </span> <span class="display-name">Lawrence Cherone</span> <span> </span> <span class="date">27 Feb 2020 at 19:49</span></td>
      </tr>
     </tbody>
    </table>
   </div>
   <br>
   <div>
    <h2 id="answer_1"><span>Answer 1</span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>0</span>
     </div>
     <div>
      <span>Answerer: </span> <span>andrewJames</span>
     </div>
     <div>
      <span> Answered: </span> <span>27 Feb 2020 at 20:23</span>
     </div>
    </div>
    <div>
     <p>There are a few changes that you would need to make to the structure and content of your JSON before DataTables can display it the way you expect.</p>
     <p>As a first step, take a look at this slimmed-down version:</p>
     <pre><code>  $(document).ready(function() {
    $('#example').DataTable( {
      "processing": true,
      "data": [{"A":"Item Number","B":"Type","C":"Form Factor","D":"Processor","E":"Condition Code","F":"Receive Status","G":"Unit Cost","H":"Qty"},{"A":"DELL VENUE 11 PRO KEYBOARD","B":"","C":"","D":"","E":"NEW","F":"Received","G":"$80.00","H":6},{"A":"ELITEBOOK 820 G2","B":"Laptop","C":"","D":"i5","E":"REF","F":"Received","G":"$90.00","H":1}],
      "columns": [
        { data: "A" },
        { data: "B" },
        { data: "C" },
        { data: "D" }
      ]
    });
  });
</code></pre>
     <p>The revised JSON has this structure - an array of objects. Nesting has been removed:</p>
     <pre><code>[{
    "A": "Item Number",
    "B": "Type",
    "C": "Form Factor",
    "D": "Processor",
    "E": "Condition Code",
    "F": "Receive Status",
    "G": "Unit Cost",
    "H": "Qty"
}, {
    "A": "DELL VENUE 11 PRO KEYBOARD",
    "B": "",
    "C": "",
    "D": "",
    "E": "NEW",
    "F": "Received",
    "G": "$80.00",
    "H": 6
}, {
    "A": "ELITEBOOK 820 G2",
    "B": "Laptop",
    "C": "",
    "D": "i5",
    "E": "REF",
    "F": "Received",
    "G": "$90.00",
    "H": 1
}]
</code></pre>
     <p>Also, the JSON contains headers ("Item Number" and so on). But these will be loaded as regular rows of data. You probably don't want that in the body of your JSON, like this.</p>
     <p>Each entry such as <code>"A": "ELITEBOOK 820 G2"</code> is a name-value pair. You use the names to refer to entries - hence <code>{ data: "A" }</code> and so on.</p>
     <p>You can look int processing your "raw" JSON before you send it to your table, either in your PHP (sorry not familiar with PHP) or in JavaScript.</p>
     <p><strong>Putting it all together</strong>:</p>
     <p>I changed the HTML table to this (adding in explicit column headers):</p>
     <pre><code>&lt;table id="example" class="display dataTable cell-border" style="width:100%"&gt;
    &lt;thead&gt; 
        &lt;tr&gt;
            &lt;th&gt;Item Number&lt;/th&gt;
            &lt;th&gt;Type&lt;/th&gt;
            &lt;th&gt;Form Factor&lt;/th&gt;
            &lt;th&gt;Processor&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
&lt;/table&gt;
</code></pre>
     <p>And I used the following to process the input data:</p>
     <pre><code>&lt;script type="text/javascript"&gt;

  var myJson = [1,{"1":{"A":"Item Number","B":"Type","C":"Form Factor","D":"Processor","E":"Condition Code","F":"Receive Status","G":"Unit Cost","H":"Qty"},"2":{"A":"DELL VENUE 11 PRO KEYBOARD","B":"","C":"","D":"","E":"NEW","F":"Received","G":"$80.00","H":6},"29":{"A":"OPTIPLEX 990","B":"Desktop","C":"","D":"i5","E":"REF","F":"Received","G":"$77.09","H":11}}]

  // discard outer levels of nesting 
  // from raw data:
  function getCleanJson() {
    var rawdata = myJson[1];
    var cleandata = [];
    var counter = 0;
    for (var key in rawdata) {
      if (rawdata.hasOwnProperty(key)) {
        // skip first row (table headings):
        if (counter &gt; 0) { 
          cleandata.push(rawdata[key]);
        }
        counter++;
      }
    }
    return cleandata;
  }

  $(document).ready(function() {
    $('#example').DataTable( {
      "processing": true,
      "data": getCleanJson(),
      "columns": [
        { data: "A" },
        { data: "B" },
        { data: "C" },
        { data: "D" }
      ]
    });
  });
&lt;/script&gt;
</code></pre>
     <p>Specifically, I changed the datatable definition to use <code>"data": getCleanJson()</code> - and then defined that function to discard the unwanted parts of the input data's structure, and also ignore heading values.</p>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <br>
   <div>
    <span>License: </span> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <span>by </span> <a href="https://stackoverflow.com/legal/terms-of-service#licensing">Stack Overflow Inc.</a>
   </div>
  </div>
 </body>
</html>