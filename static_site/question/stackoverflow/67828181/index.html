<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>Extracting substring in the middle of text under different conditions</title>
  <link rel="stylesheet" type="text/css" href="/css/base.css">
  <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
            TeX: {
            extensions: ["begingroup.js"],
            noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
            Macros: { href: "{}" }
            },
            messageStyle: "none",
            styles: { ".MathJax_Display, .MathJax_Preview, .MathJax_Preview > *": { "background": "inherit" } },
            SEEditor: "mathjaxEditing"
            });
        </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full"></script>
 </head>
 <body>
  <div class="question">
   <a href="/questions">All Questions</a>
   <h2>Extracting substring in the middle of text under different conditions</h2>
   <div class="container-metadata">
    <div>
     <span>Score: </span> <span>0</span>
    </div>
    <div>
     <span>Asker: </span> <span>Mike B.</span>
    </div>
    <div>
     <span>Asked: </span> <span>3 Jun 2021 at 20:18</span>
    </div>
    <div>
     <a href="https://stackoverflow.com/questions/67828181/extracting-substring-in-the-middle-of-text-under-different-conditions">source</a>
    </div>
   </div>
   <div>
    <p>I have strings in a column that contain persons' middle initials and last names that I need to extract. The name always appears after "Referral to " text. However, the text can end with the last name or it can have a second part that begins with " (". For example,</p>
    <p>Option 1: "Referral to J. Smith"</p>
    <p>Option 2: "Referral to S. James (1st priority)"</p>
    <p>There can be variations of text before and after, e.g.</p>
    <p>Option 1a: "Urgent Referral to J. Smith"</p>
    <p>Option 2a: "Referral to S. James (TBD)"</p>
    <p>The text I needed extracted is always located after "Referral to " and sometimes also before " ("</p>
    <p>Thank you for any help.</p>
   </div>
   <div class="tags">
    <span class="tag">google-apps-script</span><span class="tag">google-sheets</span>
   </div>
   <hr>
   <div class="comment">
    <table>
     <tbody>
      <tr>
       <td></td>
       <td><span>Regarding regular expressions: The site <a href="https://regex101.com/" rel="nofollow noreferrer">Regex101</a> provides a great way to test a regex. It also provides a (sometimes cryptic but often very clear) explanation of how the regex works. There is also a cheat sheet. Be aware that the <a href="https://support.google.com/a/answer/1371415?hl=en" rel="nofollow noreferrer">Google Scripts flavor of regex</a> is not completely compatible with the more common PCRE flavor.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">6 Jun 2021 at 15:54</span></td>
      </tr>
     </tbody>
    </table>
   </div>
   <br>
   <div>
    <h2 id="answer_1"><span>Answer 1</span> <span class="arrow"> <a href="#answer_2">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>2</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Jason E.</span>
     </div>
     <div>
      <span> Answered: </span> <span>3 Jun 2021 at 21:39</span>
     </div>
    </div>
    <div>
     <p>You can use regexextract() function in google sheets.</p>
     <p>Try this formula below:</p>
     <pre><code>=REGEXEXTRACT(A1, "\w\. \w+")
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>Hi Jason, It works!! Thank you. I am not sure what the "\w\. \w+" part does. I tried regextract, but with no success. I thought regular expression is the exact text I need to extract. That "\w\. \w+" does the magic to get the name out. How does it work?!!</span> <span> - </span> <span class="display-name">Mike B.</span> <span> </span> <span class="date">5 Jun 2021 at 16:30</span></td>
       </tr>
       <tr>
        <td>1</td>
        <td><span>Hi @MikeB. regex or regular expression is a sequence of characters that specifies a search pattern. In this case, the \w that we used is called a meta character which represents a single word/non-word letter/character. In short, we are telling the regexextract() to search for a pattern of [single-character].[space][set of characters]. You can learn more about regex here <a href="https://www3.ntu.edu.sg/home/ehchua/programming/howto/Regexe.html" rel="nofollow noreferrer">www3.ntu.edu.sg/home/ehchua/programming/howto/Regexe.html</a></span> <span> - </span> <span class="display-name">Jason E.</span> <span> </span> <span class="date">7 Jun 2021 at 15:24</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_2"><span>Answer 2</span> <span class="arrow"> <a href="#answer_1">↑</a> </span> <span class="arrow"> <a href="#answer_3">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>1</span>
     </div>
     <div>
      <span>Answerer: </span> <span>MattKing</span>
     </div>
     <div>
      <span> Answered: </span> <span>3 Jun 2021 at 21:00</span>
     </div>
    </div>
    <div>
     <p>There's probably a cleaner way to do it with Regex, but this might work in row 2 of an otherwise empty column if your strings are in column A starting at row 2.</p>
     <pre><code>=INDEX(IFERROR(SPLIT(MID(A2:A,FIND("Referral to",A2:A)+12,100)," (",0)),,1)
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>Hi MattKing, thank you for the suggestion. I placed the actual text sample "Tech-Internet need: Referral to J. Smith" in cell A2 and placed your formula in B2 and I got an empty cell. I'm not exactly sure what the formula does, but it doesn't seem to work in this case.</span> <span> - </span> <span class="display-name">Mike B.</span> <span> </span> <span class="date">5 Jun 2021 at 16:28</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>@MikeB. Apologies, it was hard to do blind without a sample sheet. I made one here. You were right there was a typo in my formula. I've since edited it and it seems to work fine. <a href="https://docs.google.com/spreadsheets/d/1c5EIWmBt4yOsIxUSvqZF4giRSgTsBqBo5F6w_uuEZLI/edit#gid=2100307022" rel="nofollow noreferrer">docs.google.com/spreadsheets/d/…</a></span> <span> - </span> <span class="display-name">MattKing</span> <span> </span> <span class="date">5 Jun 2021 at 17:46</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_3"><span>Answer 3</span> <span class="arrow"> <a href="#answer_2">↑</a> </span> <span class="arrow"> <a href="#answer_4">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>1</span>
     </div>
     <div>
      <span>Answerer: </span> <span>andrewJames</span>
     </div>
     <div>
      <span> Answered: </span> <span>3 Jun 2021 at 21:17</span>
     </div>
    </div>
    <div>
     <p>An approach which does not use a regex to parse names from strings:</p>
     <p></p>
     <div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
      <div class="snippet-code">
       <pre class="snippet-code-js lang-js prettyprint-override"><code>// array of data extracted from the sheet:
var strings = [ 
  'Referral to J. Smith', 
  'Referral to S. James (1st priority)',
  'Urgent Referral to J. Smith',
  'Referral to S. James (TBD)'
];

var minBoundary = 'Referral to ';
var maxBoundary = ' (';

strings.forEach((str) =&gt; { 
  var min = str.indexOf(minBoundary) + minBoundary.length;
  var max = str.lastIndexOf(maxBoundary);
  max = (max &lt; 0) ? str.length : max;
  var name = str.substring(min, max);
  console.log(name);
} );</code></pre>
      </div>
     </div>
     <p></p>
     <p>This searches for the location of the starting boundary text, and ending boundary text. For the ending boundary, that is either the location of the final <code> (</code>, or the end of the string if there is no <code> (</code>.</p>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>Thank you @andrewjames. One thing that my script does is it is looking row by row, extract the name of the person, retrieve their e-mail address form another sheet and sends an e-mail. So, I don't need to extract all the names, just the one in the current row that "for (var i in data) {...}" looks at. I tried using just the parts for the boundaries, but they didn't work indexOf(minBoundary) has issues. Any suggestion is highly appreciated. Thank youl</span> <span> - </span> <span class="display-name">Mike B.</span> <span> </span> <span class="date">6 Jun 2021 at 07:45</span></td>
       </tr>
       <tr>
        <td>1</td>
        <td><span>What is the exact data value you had a problem with? <code>indexOf(minBoundary)</code> assumes there is always a substring containing <code>Referral to </code> in every value (based on the description given in the question). If there are variations of that, then the code may need to be adjusted. So, for example if its <code>referral to </code> or <code>Ref. to </code>, then those would need to be handled differently in the code.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">6 Jun 2021 at 13:27</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>Thank you, @andrewjames - all worked perfectly, I just needed to tweak it a bit to work within my for loops.</span> <span> - </span> <span class="display-name">Mike B.</span> <span> </span> <span class="date">8 Jun 2021 at 12:24</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_4"><span>Answer 4</span> <span class="arrow"> <a href="#answer_3">↑</a> </span> <span class="arrow"> <a href="#answer_5">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>1</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Aresvik</span>
     </div>
     <div>
      <span> Answered: </span> <span>3 Jun 2021 at 22:47</span>
     </div>
    </div>
    <div>
     <p>A simple <code>regexextract</code> can do this. In case there are multiple initials or hyphenated names, try:</p>
     <p><code>=arrayformula(if(A1:A&lt;&gt;"",regexextract(A1:A,"to (\w[\w\. -]+\w+)"),))</code></p>
     <p>The <code>arrayformula</code> allows the <code>regexextract</code> to run down the sheet, whilst Col <code>A</code> has a value <code>A1:A&lt;&gt;""</code>.</p>
     <p><a href="https://i.stack.imgur.com/q2xFF.png" rel="nofollow noreferrer"><img src="/question/stackoverflow/67828181/q2xFF.png" alt="enter image description here"></a></p>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_5"><span>Answer 5</span> <span class="arrow"> <a href="#answer_4">↑</a> </span> <span class="arrow"> <a href="#answer_6">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>0</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Cooper</span>
     </div>
     <div>
      <span> Answered: </span> <span>3 Jun 2021 at 21:10</span>
     </div>
    </div>
    <div>
     <pre><code>function getInitials() {
  const ss = SpreadsheetApp.getActive();
  const sh = ss.getSheetByName('Sheet2');
  const vs = sh.getRange(1,1,sh.getLastRow()).getDisplayValues();//all of my strings were in column one
  let iA = [];
  vs.forEach((r,i)=&gt;{
    iA.push({row: i+1,initials: [...r[0].toString().matchAll(/[A-Z]{1,}\.{1,}/g)].map(e =&gt; e[0].split("")[0]).join(',')});
  });
  Logger.log(JSON.stringify(iA));
}
</code></pre>
     <p>Sample Output:</p>
     <pre><code>Execution log
5:29:05 PM  Notice  Execution started
5:29:07 PM  Info    [{"row":1,"initials":"J,P,J,J"},{"row":2,"initials":"J,P,J,J"},{"row":3,"initials":"J,P,J,J"},{"row":4,"initials":"J,P,J,J"},{"row":5,"initials":"J,P,J,J"},{"row":6,"initials":"J,P,J,J"},{"row":7,"initials":"J,P,J,J"},{"row":8,"initials":"J,P,J,J"}]
5:29:07 PM  Notice  Execution completed
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_6"><span>Answer 6</span> <span class="arrow"> <a href="#answer_5">↑</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>0</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Erik Tyler</span>
     </div>
     <div>
      <span> Answered: </span> <span>4 Jun 2021 at 02:02</span>
     </div>
    </div>
    <div>
     <p>Supposing your original strings were in A2:A, place this in B2:</p>
     <p><code>=ArrayFormula(IF(A:A="",,TRIM(REGEXEXTRACT(A:A&amp;"(","to ([^(]+)"))))</code></p>
     <p>The benefit of this particular method over perhaps others is that it will also extract names with apostrophes and foreign characters (e.g., F. O'Donald, J. Muñoz, C. Adriáno, etc.).</p>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>Hi Erik, thank you for the suggestion. I placed the actual text sample "Tech-Internet need: Referral to J. Smith" in cell A2 and placed your formula in B2 and I got Formula parse Error. I'm not exactly sure what the formula does, but it doesn't seem to work in this case.</span> <span> - </span> <span class="display-name">Mike B.</span> <span> </span> <span class="date">5 Jun 2021 at 16:26</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>My formula is written to process the entire column A:A, not A2 or A2:A. Try changing A:A to A2:A and see if that works. If not, then you may be in a country that uses semicolons where the US uses commas. What is your locale? It is always most efficient to share a link to a sample spreadsheet. There is much that can only be assessed by seeing your actual sheet, locale, data, layout, etc.</span> <span> - </span> <span class="display-name">Erik Tyler</span> <span> </span> <span class="date">5 Jun 2021 at 16:31</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>Also, are you using Google Sheets? Or are you trying to work with an Excel file that's in your Google Drive?</span> <span> - </span> <span class="display-name">Erik Tyler</span> <span> </span> <span class="date">5 Jun 2021 at 16:35</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <br>
   <div>
    <span>License: </span> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <span>by </span> <a href="https://stackoverflow.com/legal/terms-of-service#licensing">Stack Overflow Inc.</a>
   </div>
  </div>
 </body>
</html>