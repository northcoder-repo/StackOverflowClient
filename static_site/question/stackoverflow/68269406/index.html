<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>XML Parsing Error: not well-formed using dataTable and data from text file</title>
  <link rel="stylesheet" type="text/css" href="/css/base.css">
  <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
            TeX: {
            extensions: ["begingroup.js"],
            noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
            Macros: { href: "{}" }
            },
            messageStyle: "none",
            styles: { ".MathJax_Display, .MathJax_Preview, .MathJax_Preview > *": { "background": "inherit" } },
            SEEditor: "mathjaxEditing"
            });
        </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full"></script>
 </head>
 <body>
  <div class="question">
   <a href="/questions">All Questions</a>
   <h2>XML Parsing Error: not well-formed using dataTable and data from text file</h2>
   <div class="container-metadata">
    <div>
     <span>Score: </span> <span>1</span>
    </div>
    <div>
     <span>Asker: </span> <span>Jfreixa</span>
    </div>
    <div>
     <span>Asked: </span> <span>6 Jul 2021 at 11:03</span>
    </div>
    <div>
     <a href="https://stackoverflow.com/questions/68269406/xml-parsing-error-not-well-formed-using-datatable-and-data-from-text-file">source</a>
    </div>
   </div>
   <div>
    <p>I am trying to create a dataTable from a text file and I get XML Parsing Error: not well-formed.</p>
    <p>The text file I am using contains two header lines starting with #. Then every line has several columns, I am interested in the first eight columns. An extract from that file is:</p>
    <pre><code>#                       Retrieval interval          Variable1             Variable2              Variable3
#             start time                 end time   Delta         total   Delta         total    Delta      total
2020-12-05T00:00:00.128Z 2020-12-05T23:59:59.378Z   0.001765  59.738120   0.001765  59.808426    0.040705  59.940714
2020-12-05T23:59:59.378Z 2020-12-06T23:59:59.378Z   0.001418  59.736702   0.001418  59.807008   -0.024148  59.964862
2020-12-07T00:00:00.128Z 2020-12-07T23:59:59.378Z   0.001597  59.735105   0.001597  59.805411    0.024475  59.940387
2020-12-08T00:00:00.128Z 2020-12-08T23:59:59.378Z   0.001554  59.733551   0.001554  59.803857   -0.004524  59.944911
2020-12-09T00:00:00.128Z 2020-12-09T23:59:59.378Z   0.001776  59.731775   0.001776  59.802081   -0.003322  59.948233
2020-12-10T00:00:00.128Z 2020-12-10T23:59:59.378Z   0.000620  59.731155   0.000620  59.801461    0.017073  59.931160
2020-12-11T00:00:00.128Z 2020-12-11T23:59:59.378Z   0.001743  59.729412   0.001743  59.799718   -0.018987  59.950147
2020-12-12T00:00:00.128Z 2020-12-12T23:59:59.378Z   0.000973  59.728439   0.000973  59.798745    0.033104  59.917043
2020-12-13T00:00:00.128Z 2020-12-13T23:59:59.378Z   0.001660  59.726779   0.001660  59.797085   -0.026506  59.943549
2020-12-14T00:00:00.128Z 2020-12-14T23:59:59.378Z   0.001125  59.725654   0.001125  59.795960    0.055134  59.888415
2020-12-15T00:00:00.128Z 2020-12-15T23:59:59.378Z   0.000924  59.724730   0.000924  59.795036   -0.031429  59.919844
2020-12-15T23:59:59.756Z 2020-12-16T23:59:59.757Z   0.001986  59.722744   0.001885  59.793151    0.023362  59.896482
2020-12-17T00:00:00.128Z 2020-12-17T23:59:59.756Z   0.003619  59.719125   0.003571  59.789580   -0.002108  59.898590
2020-12-18T00:00:00.128Z 2020-12-18T23:59:59.756Z   0.001208  59.717917   0.001152  59.788428   -0.013224  59.911814
2020-12-19T00:00:00.128Z 2020-12-19T23:59:59.757Z   0.001437  59.716480   0.001366  59.787062    0.032044  59.879770
2020-12-20T00:00:00.128Z 2020-12-20T23:59:59.756Z   0.001406  59.715074   0.001333  59.785729   -0.021751  59.901521
2020-12-21T00:00:00.128Z 2020-12-21T23:59:59.757Z   0.001067  59.714007   0.001012  59.784717    0.043564  59.857957
2020-12-22T00:00:00.128Z 2020-12-22T23:59:59.757Z   0.001155  59.712852   0.001101  59.783616   -0.033792  59.891749
</code></pre>
    <p>When I hardcode the value of the data like:</p>
    <pre><code>var data_to_table = [
    [
        "2013-11-22T00:00:00.000Z", 
        "2013-11-22T00:00:00.000Z", 
        "0.000000", 
        "105.500000", 
        "0.000000", 
        "105.500000", 
        "0.000000", 
        "105.500000"
    ], 
    [
        "2013-11-22T00:00:00.000Z", 
        "2013-11-25T00:00:00.000Z", 
        "0.342000", 
        "105.158000", 
        "0.342000", 
        "105.158000", 
        "1.900000", 
        "103.600000"
    ]

</code></pre>
    <p>I get the correct table, but when I mine the data from the file itself I get this error message. I have check with some <code>console.log()</code> that I get an array from the function <code>data2json</code>. I am not a <code>js</code> developer and I am a little bit lost with this kind of errors. This is the code I use, under a file called fuel2json.js:</p>
    <pre><code>
$(document).ready(function() {
    $('#fuelTable').DataTable( {
        data: data2json("processDump.fuel_history")
    } );
},
function(error){
    console.log(error)
} );

function data2json(file){
    var array_data = [];
    $.ajax({
    url:file,
    dataType:"text",
    success:function(data){
        var fuel_data = data.split("\n");

        for(var count = fuel_data.length-1; count&gt;=0; count--)
        {
        if( fuel_data[count].charAt(0) !== '#')
        {
            var cell_data = fuel_data[count].split(/\s+/);
            if(cell_data.length &gt; 1){
            array_data.push(cell_data.slice(0,8))
            };
        };
        };
    }
    });
    return array_data
};

</code></pre>
    <p>My html file is:</p>
    <pre><code>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;
&lt;html&gt;
&lt;body&gt;
    &lt;table id="fuelTable" class="display" style="width:100%" data-order='[[0,"desc"]]'&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;Start&lt;/th&gt;
                &lt;th&gt;End&lt;/th&gt;
                &lt;th&gt;VAL1&lt;/th&gt;
                &lt;th&gt;VAL2&lt;/th&gt;
                &lt;th&gt;VAL3&lt;/th&gt;
                &lt;th&gt;VAL4&lt;/th&gt;
        &lt;th&gt;VAL5&lt;/th&gt;
        &lt;th&gt;VAL6&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tfoot&gt;
            &lt;tr&gt;
                &lt;th&gt;Start&lt;/th&gt;
                &lt;th&gt;End&lt;/th&gt;
                &lt;th&gt;VAL1&lt;/th&gt;
                &lt;th&gt;VAL2&lt;/th&gt;
                &lt;th&gt;VAL3&lt;/th&gt;
                &lt;th&gt;VAL4&lt;/th&gt;
        &lt;th&gt;VAL5&lt;/th&gt;
        &lt;th&gt;VAL6&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/tfoot&gt;
    &lt;/table&gt;    

  &lt;script type="text/javascript" src="../js/jquery.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="./fuel2json.js"&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;

</code></pre>
   </div>
   <div class="tags">
    <span class="tag">javascript</span><span class="tag">datatables</span><span class="tag">xml-parsing</span>
   </div>
   <hr>
   <div class="comment">
    <table>
     <tbody>
      <tr>
       <td>1</td>
       <td><span>Some notes: (1) I cannot recreate that specific "xml parsing error" you are getting. (2) Your JavaScript code is OK - it parses the data from JSON to a JS array correctly (as you alrady know, I am sure). (3) Because you are calling jQuery ajax from DataTables, that is an asynchronous call, so the data from the function is not made available to your DataTable soon enough - the table is already built. (4) To handle item 3, I recommend you move your ajax call into the DataTable. When I do that, your data is displayed correctly.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">6 Jul 2021 at 13:44</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Because of problem (1) above, we need to see more of your code. Can you show us the HTML you are using?, And a sample of the source data file?</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">6 Jul 2021 at 13:45</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>I have edited the question in order to include the html and some extract of the data file as @andrewjames asked. The problem here is that I don't know how to move the ajax call into the DataTable... as I said I am not a javascript, ajax... developer and it is difficult to me to be aware of how this works (asynchronous calls, promises...)</span> <span> - </span> <span class="display-name">Jfreixa</span> <span> </span> <span class="date">6 Jul 2021 at 14:04</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Thank you for the edits. I am sill not able to recreate your XML error, unfortunately. My version of your code is working OK. Some things I notice: (a) The HTML prolog typically only needs to be <code>&lt;!DOCTYPE html&gt;</code>. The rest of the declaration should not be needed (assuming HTML5 is OK for you). (b) I don't see the DataTabales CSS resource - I only see 3 JS resources. (c) All these resources should be in the &lt;head&gt;...&lt;/head&gt;` section of the web page. But none of these things explain the error you are getting.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">6 Jul 2021 at 14:15</span></td>
      </tr>
     </tbody>
    </table>
   </div>
   <br>
   <div>
    <h2 id="answer_1"><span>Answer 1</span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>1</span>
     </div>
     <div>
      <span>Answerer: </span> <span>andrewJames</span>
     </div>
     <div>
      <span> Answered: </span> <span>6 Jul 2021 at 14:23</span>
     </div>
    </div>
    <div>
     <p>Here is my approach, based on your code, but re-arranged as described in my comments in the question:</p>
     <p><strong>The source data:</strong></p>
     <pre><code># header 1
# header 2
2013-11-22T00:00:00.000Z 2013-11-22T00:00:00.000Z 0.000000 105.500000 0.000000 105.500000 0.000000 105.500000 
2013-11-22T00:00:00.000Z 2013-11-25T00:00:00.000Z 0.342000 105.158000 0.342000 105.158000 1.900000 103.600000 csv_data2.htm:55:16
</code></pre>
     <p><strong>The HTML file</strong>:</p>
     <pre><code>&lt;!DOCTYPE html&gt;

&lt;html&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;Demo&lt;/title&gt;
  &lt;script src="https://code.jquery.com/jquery-3.5.1.js"&gt;&lt;/script&gt;
  &lt;script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"&gt;&lt;/script&gt;
  &lt;link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css"&gt;
  &lt;link rel="stylesheet" type="text/css" href="https://datatables.net/media/css/site-examples.css"&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;div style="margin: 20px;"&gt;

    &lt;table id="fuelTable" class="display" style="width:100%" data-order='[[0,"desc"]]'&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;Start&lt;/th&gt;
                &lt;th&gt;End&lt;/th&gt;
                &lt;th&gt;VAL1&lt;/th&gt;
                &lt;th&gt;VAL2&lt;/th&gt;
                &lt;th&gt;VAL3&lt;/th&gt;
                &lt;th&gt;VAL4&lt;/th&gt;
        &lt;th&gt;VAL5&lt;/th&gt;
        &lt;th&gt;VAL6&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tfoot&gt;
            &lt;tr&gt;
                &lt;th&gt;Start&lt;/th&gt;
                &lt;th&gt;End&lt;/th&gt;
                &lt;th&gt;VAL1&lt;/th&gt;
                &lt;th&gt;VAL2&lt;/th&gt;
                &lt;th&gt;VAL3&lt;/th&gt;
                &lt;th&gt;VAL4&lt;/th&gt;
        &lt;th&gt;VAL5&lt;/th&gt;
        &lt;th&gt;VAL6&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/tfoot&gt;
    &lt;/table&gt; 

&lt;/div&gt;

&lt;script&gt;

$(document).ready(function() {
    $('#fuelTable').DataTable( {
        ajax: {
            url: "http://localhost:7000/csvdata",
            dataType: "text",
            dataSrc: function ( csv_data ) {
                console.log(csv_data);
                var array_data = [];
                var fuel_data = csv_data.split("\n");

                for (var count = fuel_data.length-1; count&gt;=0; count--) {
                    if ( fuel_data[count].charAt(0) !== '#') {
                        var cell_data = fuel_data[count].split(/\s+/);
                        if (cell_data.length &gt; 1) {
                            array_data.push(cell_data.slice(0,8))
                        }
                    }
                }
                console.log(array_data);
                return array_data;
            }
        }
    } );
} );

&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
     <p><strong>Notes:</strong></p>
     <p>In my case, I am using the following for my URL:</p>
     <pre><code>url: "http://localhost:7000/csvdata"
</code></pre>
     <p>This is because my browser blocks file-based URLs, for security reasons (CORS), so I have to use a HTTP source. But the URL simply returns the text of the source data file.</p>
     <p>I have moved the Ajax call into the body of the DataTable. In this case, we need to use a <code>dataSrc</code> function - and that is where you can see your CSV-to-arrays logic.</p>
     <p>Now, DataTables will have access to the array data before it completes its initialization.</p>
     <p>The end result:</p>
     <p><a href="https://i.stack.imgur.com/y807L.png" rel="nofollow noreferrer"><img src="/question/stackoverflow/68269406/y807L.png" alt="enter image description here"></a></p>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>I have followed your modification of the html, with the Ajax call into the body and the use of dataSrc and now I get the data in the browser. I still get the comment about the XML parsing error but it work. Thanks!!!</span> <span> - </span> <span class="display-name">Jfreixa</span> <span> </span> <span class="date">7 Jul 2021 at 10:41</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>Try using a HTML validator, for example <a href="https://www.freeformatter.com/html-validator.html" rel="nofollow noreferrer">this one</a>, to see if that explains the parsing error. This may not help, but is worth trying.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">7 Jul 2021 at 11:58</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <br>
   <div>
    <span>License: </span> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <span>by </span> <a href="https://stackoverflow.com/legal/terms-of-service#licensing">Stack Overflow Inc.</a>
   </div>
  </div>
 </body>
</html>