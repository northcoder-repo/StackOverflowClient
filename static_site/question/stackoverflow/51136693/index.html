<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>how to check HikariCP connection pooling is working or not in Java?</title>
  <link rel="stylesheet" type="text/css" href="/css/base.css">
  <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
            TeX: {
            extensions: ["begingroup.js"],
            noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
            Macros: { href: "{}" }
            },
            messageStyle: "none",
            styles: { ".MathJax_Display, .MathJax_Preview, .MathJax_Preview > *": { "background": "inherit" } },
            SEEditor: "mathjaxEditing"
            });
        </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full"></script>
 </head>
 <body>
  <div class="question">
   <a href="/questions">All Questions</a>
   <h2>how to check HikariCP connection pooling is working or not in Java?</h2>
   <div class="container-metadata">
    <div>
     <span>Score: </span> <span>17</span>
    </div>
    <div>
     <span>Asker: </span> <span>Tejal</span>
    </div>
    <div>
     <span>Asked: </span> <span>2 Jul 2018 at 12:52</span>
    </div>
    <div>
     <a href="https://stackoverflow.com/questions/51136693/how-to-check-hikaricp-connection-pooling-is-working-or-not-in-java">source</a>
    </div>
   </div>
   <div>
    <p>I have written following properties in my configuration files I am using <code>Log4j</code> in my application When I am running a project.</p>
    <p>I am getting following message.does that mean connection pooling is configured in my project? if not then how it will be?</p>
    <p><strong>INFO: internal.ConnectionProviderInitiator - HHH000130: Instantiating explicit connection provider: com.zaxxer.hikari.hibernate.HikariConnectionProvider</strong></p>
    <p>I have referred following link also</p>
    <p><a href="https://stackoverflow.com/questions/30814002/how-to-configure-log4j2-to-log-for-hikaricp">link here</a></p>
    <h1>Datasource settings</h1>
    <pre><code>hibernate.datasource.driver-class-name=com.mysql.jdbc.Driver
hibernate.datasource.url=jdbc:mysql://localhost:3306/mydb
hibernate.datasource.username=root
hibernate.datasource.password=root
</code></pre>
    <h1>HikariCP Settings</h1>
    <pre><code>hibernate.hikari.dataSource.url=jdbc:mysql://localhost:3306/mydb
hibernate.hikari.idleTimeout=10
hibernate.hikari.maximumPoolSize=30
hibernate.hikari.minimumIdle=15
hibernate.connection.provider_class=com.zaxxer.hikari.hibernate.HikariConnectionProvider
hibernate.hikari.dataSourceClassName=com.mysql.jdbc.jdbc2.optional.MysqlDataSource
</code></pre>
   </div>
   <div class="tags">
    <span class="tag">java</span><span class="tag">mysql</span><span class="tag">hibernate</span><span class="tag">connection-pooling</span><span class="tag">hikaricp</span>
   </div>
   <hr>
   <div class="comment">
    <table>
     <tbody>
      <tr>
       <td></td>
       <td><span>May be this will useful:<a href="https://stackoverflow.com/questions/5134515/how-would-you-test-a-connection-pool" title="how would you test a connection pool">stackoverflow.com/questions/5134515/…</a></span> <span> - </span> <span class="display-name">soorapadman</span> <span> </span> <span class="date">2 Jul 2018 at 13:14</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>@soorapadman INFO: internal.ConnectionProviderInitiator - HHH000130: Instantiating explicit connection provider: com.zaxxer.hikari.hibernate.HikariConnectionProvider does this means connection pooling is established.?</span> <span> - </span> <span class="display-name">Tejal</span> <span> </span> <span class="date">2 Jul 2018 at 13:15</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Please add poolname and check weather its initiating or not . Obviously initialize connection pool one time only.</span> <span> - </span> <span class="display-name">soorapadman</span> <span> </span> <span class="date">2 Jul 2018 at 13:20</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>@soorapadman yes right after loading I am getting INFO: internal.ConnectionProviderInitiator - HHH000130.... into console</span> <span> - </span> <span class="display-name">Tejal</span> <span> </span> <span class="date">2 Jul 2018 at 13:23</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Look like your configuration fine for me .</span> <span> - </span> <span class="display-name">soorapadman</span> <span> </span> <span class="date">2 Jul 2018 at 13:28</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>@soorapadman yes I am not getting any error while loading application but how I will know that connection pooling is properly configured in my project.</span> <span> - </span> <span class="display-name">Tejal</span> <span> </span> <span class="date">2 Jul 2018 at 13:35</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Did you add poolname in properties? once you add you could see started and completed message .</span> <span> - </span> <span class="display-name">soorapadman</span> <span> </span> <span class="date">2 Jul 2018 at 13:46</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Check this link if you want test :<a href="https://dzone.com/articles/database-connection-pooling-in-java-with-hikaricp" rel="nofollow noreferrer">dzone.com/articles/…</a></span> <span> - </span> <span class="display-name">soorapadman</span> <span> </span> <span class="date">2 Jul 2018 at 13:46</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>what's your hibernate version?</span> <span> - </span> <span class="display-name">Ori Marko</span> <span> </span> <span class="date">29 Aug 2018 at 09:10</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>@user7294900 hibernate version is 4</span> <span> - </span> <span class="display-name">Tejal</span> <span> </span> <span class="date">30 Aug 2018 at 02:41</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>So … was all of this prior to Springboot 2.0+? I read elsewhere that basically hikari is used essentially by default in 2.0+</span> <span> - </span> <span class="display-name">dlamblin</span> <span> </span> <span class="date">3 Mar 2021 at 08:04</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>@dlamblin Thanks for replying , sometimes what we read on internet is not always right and in spring boot project with minimal configuration changes we can add HikariCp .</span> <span> - </span> <span class="display-name">Tejal</span> <span> </span> <span class="date">4 Mar 2021 at 04:52</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Thanks Tejal, but I suppose from your question and its answers that you were not using springboot nor spring at all.</span> <span> - </span> <span class="display-name">dlamblin</span> <span> </span> <span class="date">6 Mar 2021 at 08:35</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>@dlamblin you are right .</span> <span> - </span> <span class="display-name">Tejal</span> <span> </span> <span class="date">7 Mar 2021 at 08:32</span></td>
      </tr>
     </tbody>
    </table>
   </div>
   <br>
   <div>
    <h2 id="answer_1"><span>Answer 1</span> <span class="arrow"> <a href="#answer_2">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>10</span>
     </div>
     <div>
      <span>Answerer: </span> <span>LMC</span>
     </div>
     <div>
      <span> Answered: </span> <span>3 Jul 2018 at 19:24</span>
     </div>
    </div>
    <div>
     <p>First, configuration is no consistent since maximum &lt; minimumIdle. Those should be set at most to the same value.</p>
     <pre><code>hibernate.hikari.maximumPoolSize=10
hibernate.hikari.minimumIdle=10
</code></pre>
     <p>If the pools is working you should see 10 ESTABLISHED connections to port 3306 (or mssql 1433 in the example below).</p>
     <pre><code>lsof -nP -i :1433 -sTCP:ESTABLISHED
COMMAND  PID       USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME
java    1596 lmc  260u  IPv6 1624799      0t0  TCP 127.0.0.1:43022-&gt;127.0.0.1:1433 (ESTABLISHED)
java    1596 lmc  265u  IPv6 1626072      0t0  TCP 127.0.0.1:43026-&gt;127.0.0.1:1433 (ESTABLISHED)
java    1596 lmc  266u  IPv6 1630933      0t0  TCP 127.0.0.1:43030-&gt;127.0.0.1:1433 (ESTABLISHED)
java    1596 lmc  267u  IPv6 1631705      0t0  TCP 127.0.0.1:43034-&gt;127.0.0.1:1433 (ESTABLISHED)
java    1596 lmc  268u  IPv6 1632268      0t0  TCP 127.0.0.1:43038-&gt;127.0.0.1:1433 (ESTABLISHED)
java    1596 lmc  269u  IPv6 1632273      0t0  TCP 127.0.0.1:43042-&gt;127.0.0.1:1433 (ESTABLISHED)
java    1596 lmc  270u  IPv6 1632278      0t0  TCP 127.0.0.1:43046-&gt;127.0.0.1:1433 (ESTABLISHED)
</code></pre>
     <p>Using <code>ss</code> (socket statistics)</p>
     <pre><code>ss -46 -np state established dport = :1433 | grep 'java' | sort -r -k 3,3 | nl
     1  tcp    0       0          [::ffff:127.0.0.1]:43158     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=273))                                               
     2  tcp    0       0          [::ffff:127.0.0.1]:43154     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=272))                                               
     3  tcp    0       0          [::ffff:127.0.0.1]:43150     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=271))                                               
     4  tcp    0       0          [::ffff:127.0.0.1]:43142     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=270))                                               
     5  tcp    0       0          [::ffff:127.0.0.1]:43138     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=269))                                               
     6  tcp    0       0          [::ffff:127.0.0.1]:43134     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=268))                                               
     7  tcp    0       0          [::ffff:127.0.0.1]:43130     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=267))                                               
     8  tcp    0       0          [::ffff:127.0.0.1]:43126     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=266))                                               
     9  tcp    0       0          [::ffff:127.0.0.1]:43122     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=265))                                               
    10  tcp    0       0          [::ffff:127.0.0.1]:43118     [::ffff:127.0.0.1]:1433   users:(("java",pid=1596,fd=260))
</code></pre>
     <p>Using <code>netstat</code> (deprecated on some distros in favor of <code>ss</code>)</p>
     <pre><code>netstat -ant | grep 3306
tcp        0      0 127.0.0.1:41722     127.0.0.1:3306      ESTABLISHED 
tcp        0      0 127.0.0.1:41730     127.0.0.1:3306      ESTABLISHED 
tcp        0      0 127.0.0.1:41728     127.0.0.1:3306      ESTABLISHED 
tcp        0      0 127.0.0.1:41726     127.0.0.1:3306      ESTABLISHED 
tcp        0      0 127.0.0.1:41716     127.0.0.1:3306      ESTABLISHED 
tcp        0      0 127.0.0.1:41732     127.0.0.1:3306      ESTABLISHED 
tcp        0      0 127.0.0.1:41720     127.0.0.1:3306      ESTABLISHED 
tcp        0      0 127.0.0.1:41736     127.0.0.1:3306      ESTABLISHED 
tcp        0      0 127.0.0.1:41718     127.0.0.1:3306      ESTABLISHED 
tcp        0      0 127.0.0.1:41724     127.0.0.1:3306      ESTABLISHED
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>An excellent way to test. Thanks a lot.</span> <span> - </span> <span class="display-name">coretechie</span> <span> </span> <span class="date">17 Nov 2022 at 15:36</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_2"><span>Answer 2</span> <span class="arrow"> <a href="#answer_1">↑</a> </span> <span class="arrow"> <a href="#answer_3">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>5</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Ori Marko</span>
     </div>
     <div>
      <span> Answered: </span> <span>29 Aug 2018 at 10:16</span>
     </div>
    </div>
    <div>
     <p>See HikariCP note about <a href="https://github.com/brettwooldridge/HikariCP" rel="noreferrer">MySQL</a>:</p>
     <blockquote>
      <p>The MySQL DataSource is known to be broken with respect to network timeout support. Use jdbcUrl configuration instead.</p>
     </blockquote>
     <p>You need to remove the below line and Hikari will find the driver</p>
     <pre><code>hibernate.datasource.driver-class-name=com.mysql.jdbc.Driver
</code></pre>
     <blockquote>
      <p><strong>jdbcUrl</strong> This property directs HikariCP to use "DriverManager-based" configuration. We feel that DataSource-based configuration (above) is superior</p>
     </blockquote>
     <p>Also try adding the following as suggested when using <a href="https://github.com/brettwooldridge/HikariCP/wiki/Hibernate4" rel="noreferrer">Hibernate4</a>:</p>
     <blockquote>
      <pre><code>hibernate.hikari.dataSource.url=jdbc:mysql://localhost/database
hibernate.hikari.dataSource.user=bart
hibernate.hikari.dataSource.password=51mp50n
</code></pre>
     </blockquote>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>For posterity, I found what appears to be the originating MySQL ticket behind that "<i>known to be broken</i>" comment: <a href="https://bugs.mysql.com/bug.php?id=75615" rel="nofollow noreferrer">Incorrect implementation of Connection.setNetworkTimeout()</a>. The ticket is in limbo. The most recent commentary I could find was this thread from 3 years ago: <a href="https://groups.google.com/g/hikari-cp/c/hwsWs42CqVA/m/6gPoORAYAQAJ" rel="nofollow noreferrer">MySQL datasource</a>: "<i>If in doubt, use JDBC-URL based configuration, instead of DataSource configurations.</i>"</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">30 Oct 2021 at 20:12</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_3"><span>Answer 3</span> <span class="arrow"> <a href="#answer_2">↑</a> </span> <span class="arrow"> <a href="#answer_4">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>2</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Ignacio Mosca</span>
     </div>
     <div>
      <span> Answered: </span> <span>2 Jul 2018 at 12:59</span>
     </div>
    </div>
    <div>
     <ol>
      <li>
       <p>Have you tried using the app to insert/update something in the database? If it fails then it's not working.</p></li>
      <li>
       <p>Another way to test it is change the datasource you provided here: <code>hibernate.hikari.dataSource.url</code> to a non-existing database.</p></li>
      <li>
       <p>Finally, change the <code>&lt;Configuration status="WARN"&gt;</code> to <code>&lt;Configuration status="DEBUG"&gt;</code></p></li>
     </ol>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>1. yes I tried inserting data into db its working fine but how I will know connection pooling is established? 2) .can you elaborate more 3).yes I tried this also</span> <span> - </span> <span class="display-name">Tejal</span> <span> </span> <span class="date">2 Jul 2018 at 13:08</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>Try changing hibernate.hikari.dataSource.url from jdbc:mysql://localhost:3306/mydb to jdbc:mysql://idontexisthost:3306/mydb to check if everything goes down. Also, do you see stuff logging when you insert something into the database?</span> <span> - </span> <span class="display-name">Ignacio Mosca</span> <span> </span> <span class="date">2 Jul 2018 at 14:19</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_4"><span>Answer 4</span> <span class="arrow"> <a href="#answer_3">↑</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>0</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Mafei</span>
     </div>
     <div>
      <span> Answered: </span> <span>7 Sep 2021 at 14:35</span>
     </div>
    </div>
    <div>
     <p>You can open MYSQL console and query by typing this query. as an example, I have added 10 connections for the pool. the username of the connection is <code>mafei_connection_test</code>. then you can see the all connection that the MySQL server created and currently opening.</p>
     <pre class="lang-sql prettyprint-override"><code>SHOW PROCESSLIST;
</code></pre>
     <pre class="lang-sql prettyprint-override"><code>mysql&gt; SHOW PROCESSLIST;
+------+-----------------------+------------------+--------------------+---------+------+------------------------+------------------+
| Id   | User                  | Host             | db                 | Command | Time | State                  | Info             |
+------+-----------------------+------------------+--------------------+---------+------+------------------------+------------------+
|    5 | event_scheduler       | localhost        | NULL               | Daemon  | 6545 | Waiting on empty queue | NULL             |
| 1315 | mafei_connection_test | 172.17.0.1:58828 | NULL               | Sleep   |   57 |                        | NULL             |
| 1316 | mafei_connection_test | 172.17.0.1:58832 | NULL               | Sleep   |   59 |                        | NULL             |
| 1317 | mafei_connection_test | 172.17.0.1:58836 | NULL               | Sleep   |   59 |                        | NULL             |
| 1318 | mafei_connection_test | 172.17.0.1:58840 | NULL               | Sleep   |   59 |                        | NULL             |
| 1319 | mafei_connection_test | 172.17.0.1:58844 | NULL               | Sleep   |   59 |                        | NULL             |
| 1320 | mafei_connection_test | 172.17.0.1:58848 | NULL               | Sleep   |   59 |                        | NULL             |
| 1321 | mafei_connection_test | 172.17.0.1:58852 | NULL               | Sleep   |   59 |                        | NULL             |
| 1322 | mafei_connection_test | 172.17.0.1:58856 | NULL               | Sleep   |   59 |                        | NULL             |
| 1323 | mafei_connection_test | 172.17.0.1:58860 | NULL               | Sleep   |   59 |                        | NULL             |
| 1324 | mafei_connection_test | 172.17.0.1:58864 | NULL               | Sleep   |   59 |                        | NULL             |
| 1326 | mafei_connection_test | 172.17.0.1:58872 | information_schema | Query   |    0 | init                   | SHOW PROCESSLIST |
| 1327 | mafei_connection_test | 172.17.0.1:58876 | NULL               | Sleep   |   11 |                        | NULL             |
+------+-----------------------+------------------+--------------------+---------+------+------------------------+------------------+
13 rows in set (0.05 sec)

</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <br>
   <div>
    <span>License: </span> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <span>by </span> <a href="https://stackoverflow.com/legal/terms-of-service#licensing">Stack Overflow Inc.</a>
   </div>
  </div>
 </body>
</html>