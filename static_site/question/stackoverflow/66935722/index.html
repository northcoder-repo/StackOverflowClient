<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>Data from spreadsheet doesn't populate in the body of the email</title>
  <link rel="stylesheet" type="text/css" href="/css/base.css">
  <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
            TeX: {
            extensions: ["begingroup.js"],
            noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
            Macros: { href: "{}" }
            },
            messageStyle: "none",
            styles: { ".MathJax_Display, .MathJax_Preview, .MathJax_Preview > *": { "background": "inherit" } },
            SEEditor: "mathjaxEditing"
            });
        </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full"></script>
 </head>
 <body>
  <div class="question">
   <a href="/questions">All Questions</a>
   <h2>Data from spreadsheet doesn't populate in the body of the email</h2>
   <div class="container-metadata">
    <div>
     <span>Score: </span> <span>0</span>
    </div>
    <div>
     <span>Asker: </span> <span>Rick Serafica</span>
    </div>
    <div>
     <span>Asked: </span> <span>3 Apr 2021 at 20:44</span>
    </div>
    <div>
     <a href="https://stackoverflow.com/questions/66935722/data-from-spreadsheet-doesnt-populate-in-the-body-of-the-email">source</a>
    </div>
   </div>
   <div>
    <p>I am trying to email some details regularly and my script doesn't seem to work well. I just need the display value of A3:C7 to be sent in a click of a button but the email isn't showing exactly the way it was on my spreadsheet. I am new on Coding . Below is the code:</p>
    <p></p>
    <div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
     <div class="snippet-code">
      <pre class="snippet-code-js lang-js prettyprint-override"><code>function sendReport (){
      var sheet = SpreadsheetApp.getActiveSpreadsheet();
      var raw = sheet.getSheetByName('Raw Data');
      var subType = raw.getRange('C3');
      var jobType = subType.getValue();
      var subID = raw.getRange('C4');
      var jobID = subID.getValue();
      var subBody = sheet.getSheetByName('Email Sheet');
      var body1 = subBody.getRange('A3:C7');
      var body = body1.getDisplayValues();
      var subject = "RCA Report " + jobType + "-" + jobID
      var message = "Hi TL, below is the " + subject
      var closing = "For any clarifications, please do not hesitate to reach out to any of the QAs. Thanks! ";
      var emailBody  = message +  body + closing;
      MailApp.sendEmail("sample@sample.com",subject,emailBody)
      
    };</code></pre>
     </div>
    </div>
    <p></p>
    <p>The result looks like this:</p>
    <p>Hi TL, below it the RCA report + jobType + "-" + jobIDCategory.Count.Judgment.16.0.27%.Did Not Load.....</p>
    <p>So the data which looks like a table in my spreadsheet was somehow written continuously in a single line on my email.</p>
    <p>Desired result:</p>
    <p>Message...</p>
    <p>Table A3:C7 (5 rows/3 columns including header)</p>
    <p>Message...</p>
   </div>
   <div class="tags">
    <span class="tag">javascript</span><span class="tag">email</span><span class="tag">google-sheets</span><span class="tag">datatable</span><span class="tag">automation</span>
   </div>
   <hr>
   <div class="comment">
    <table>
     <tbody>
      <tr>
       <td>1</td>
       <td><span>It looks like you have taken a photograph of a computer screen - and then provided that image in a link. Instead of doing that, you should provide the code as text, in the body of your question (with the appropriate formatting). You can <a href="https://stackoverflow.com/posts/66935722/edit">edit</a> your question and look at the <a href="https://stackoverflow.com/editing-help">formatting</a> options you can use.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">3 Apr 2021 at 22:20</span></td>
      </tr>
      <tr>
       <td>2</td>
       <td><span>If you have not done so yet, you can take the <a href="https://stackoverflow.com/tour">tour</a> and read <a href="https://stackoverflow.com/questions/how-to-ask">How to Ask</a>. Specifically you may want to <a href="https://stackoverflow.com/posts/66935722/edit">edit</a> your question to clarify what you mean by "doesn't seem to work" and "isn't showing exactly the way it was on my spreadsheet". Also, bear in mind you have not shared any of your spreadsheet data with us, so we do not really know what you are expecting to see in your formatted e-mail. See also <a href="https://stackoverflow.com/help/minimal-reproducible-example">minimal reproducible example</a>.</span> <span> - </span> <span class="display-name">andrewJames</span> <span> </span> <span class="date">3 Apr 2021 at 22:23</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>@andrewjames thank you for the tip. I have updated my post.</span> <span> - </span> <span class="display-name">Rick Serafica</span> <span> </span> <span class="date">4 Apr 2021 at 18:34</span></td>
      </tr>
     </tbody>
    </table>
   </div>
   <br>
   <div>
    <h2 id="answer_1"><span>Answer 1</span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>1</span>
     </div>
     <div>
      <span>Answerer: </span> <span>andrewJames</span>
     </div>
     <div>
      <span> Answered: </span> <span>4 Apr 2021 at 21:09</span>
     </div>
    </div>
    <div>
     <p>To provide spreadsheet data in a table inside your e-mail, you can build an HTML <code>&lt;table&gt;</code> in your e-mail body, and populate data from the spreadsheet into the HTML table.</p>
     <p>To do this, you need to iterate over the data in the selected spreadsheet range.</p>
     <p>Currently you have this:</p>
     <pre><code>var body1 = subBody.getRange('A3:C7');
</code></pre>
     <p>To iterate over this data, you can use 2 loops. The first will iterate over each row, and the second will iterate over each cell in the current row:</p>
     <pre><code>var dataRows = body1.getValues();
for (var i = 0; i &lt; dataRows.length; i++) {
  var dataRow = dataRows[i];
  for (var j = 0; j &lt; dataRow.length; j++) {
    var cellContents =  dataRow[j];
  }
}
</code></pre>
     <p>You can use these basic loops to build a string containing an HTML table:</p>
     <pre><code>var style = 'style="border: 1px solid black; border-collapse: collapse; padding: 5px;"';
var tableOutput = '&lt;br&gt;&lt;br&gt;&lt;table ' + style + '&gt;';

var dataRows = body1.getValues();
for (var i = 0; i &lt; dataRows.length; i++) {
  tableOutput = tableOutput + '&lt;tr&gt;';
  var dataRow = dataRows[i];
  for (var j = 0; j &lt; dataRow.length; j++) {
    var cellContents = dataRow[j];
    tableOutput = tableOutput + '&lt;td ' + style + '&gt;' + cellContents + '&lt;/td&gt;';
  }
  tableOutput = tableOutput + '&lt;/tr&gt;';
}
tableOutput = tableOutput + '&lt;/table&gt;&lt;br&gt;';
</code></pre>
     <p>Finally, because we are using HTML embedded in the body of the e-mail, we need to use the <code>htmlBody</code> parameter (documented <a href="https://developers.google.com/apps-script/reference/mail/mail-app" rel="nofollow noreferrer">here</a>):</p>
     <blockquote>
      <p><em><code>htmlBody</code>: if set, devices capable of rendering HTML will use it instead of the required body argument</em></p>
     </blockquote>
     <p>To do this, we need to change how we send the e-mail:</p>
     <pre><code>var emailBody  = message +  tableOutput + closing;
MailApp.sendEmail({
  to: "sample@sample.com",
  subject: subject,
  htmlBody: emailBody
}); 
</code></pre>
     <p>Here, we are explicitly using <code>htmlBody</code> as the body parameter, instead of the default plain string parameter.</p>
     <p>Assuming the following input:</p>
     <p><a href="https://i.stack.imgur.com/WYIYO.png" rel="nofollow noreferrer"><img src="WYIYO.png" alt="enter image description here"></a></p>
     <p>This will build the following e-mail body:</p>
     <p><a href="https://i.stack.imgur.com/UYJMx.png" rel="nofollow noreferrer"><img src="UYJMx.png" alt="enter image description here"></a></p>
     <p>In my example I provided only the most basic styling to the table, to show black border lines around each cell, with some cell padding. You can obviously change that to whatever styling you wish to use.</p>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <br>
   <div>
    <span>License: </span> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <span>by </span> <a href="https://stackoverflow.com/legal/terms-of-service#licensing">Stack Overflow Inc.</a>
   </div>
  </div>
 </body>
</html>