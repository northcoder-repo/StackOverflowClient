<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSS-only masonry layout</title>
  <link rel="stylesheet" type="text/css" href="/css/base.css">
  <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
            TeX: {
            extensions: ["begingroup.js"],
            noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
            Macros: { href: "{}" }
            },
            messageStyle: "none",
            styles: { ".MathJax_Display, .MathJax_Preview, .MathJax_Preview > *": { "background": "inherit" } },
            SEEditor: "mathjaxEditing"
            });
        </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full"></script>
 </head>
 <body>
  <div class="question">
   <a href="/questions">All Questions</a>
   <h2>CSS-only masonry layout</h2>
   <div class="container-metadata">
    <div>
     <span>Score: </span> <span>227</span>
    </div>
    <div>
     <span>Asker: </span> <span>Pekka</span>
    </div>
    <div>
     <span>Asked: </span> <span>5 Jun 2017 at 20:41</span>
    </div>
    <div>
     <a href="https://stackoverflow.com/questions/44377343/css-only-masonry-layout">source</a>
    </div>
   </div>
   <div>
    <p>I need to implement a masonry layout. However, for a number of reasons I don't want to use JavaScript to do it.</p>
    <p><a href="https://i.stack.imgur.com/Z25DI.png" rel="noreferrer"><img src="/question/stackoverflow/44377343/Z25DI.png" alt="A grid of multiple columns of rectangles of varying height."></a></p>
    <p>Parameters:</p>
    <ul>
     <li>All elements have the same width</li>
     <li>Elements have a height that cannot be calculated server side (an image plus various amounts of text)</li>
     <li>I can live with a fixed number of columns if I have to</li>
    </ul>
    <p>there is a trivial solution to this that works in modern browsers, <a href="http://w3bits.com/labs/css-masonry/" rel="noreferrer">the <code>column-count</code> property.</a></p>
    <p>The problem with that solution is that elements are ordered in columns:</p>
    <p><a href="https://i.stack.imgur.com/uRAHy.png" rel="noreferrer"><img src="/question/stackoverflow/44377343/uRAHy.png" alt="Starting from the top leftmost box, they're numbered 1 through 4 straight down, the topmost box in the next column is 5, and so on."></a></p>
    <p>While I need the elements to be ordered in rows, at least approximately:</p>
    <p><a href="https://i.stack.imgur.com/d991Y.png" rel="noreferrer"><img src="/question/stackoverflow/44377343/d991Y.png" alt="Starting from the top leftmost box, they're numbered 1 through 6 straight across, but because box 5 is the shortest the box underneath it is 7 as it has the appearance of being on a row higher than the next box on the far left."></a></p>
    <p>Approaches I've tried that don't work:</p>
    <ul>
     <li>Making items <code>display: inline-block</code>: <a href="https://jsfiddle.net/p0czqdz0/7/" rel="noreferrer">wastes vertical space.</a></li>
     <li>Making items <code>float: left</code>: <a href="https://jsfiddle.net/p0czqdz0/8/" rel="noreferrer">lol, no.</a></li>
    </ul>
    <p>Now I <em>could</em> change the server side rendering and reorder the items dividing the number of items by the number of columns, but that's complicated, error-prone (based on how browsers decide to split the item list into columns), so I'd like to avoid it if possible.</p>
    <p>Is there some flexbox magic that makes this possible?</p>
   </div>
   <div class="tags">
    <span class="tag">html</span><span class="tag">css</span><span class="tag">flexbox</span><span class="tag">css-grid</span>
   </div>
   <hr>
   <div class="comment">
    <table>
     <tbody>
      <tr>
       <td>8</td>
       <td><span>Can't think of a way that does not depend on predefined heights. If you reconsider JS, have a look at <a href="https://stackoverflow.com/questions/13518653/layout-theory-for-a-thumbnail-gallery/13521470#13521470" title="layout theory for a thumbnail gallery">stackoverflow.com/questions/13518653/…</a> where i implement such a solution that is quite simple.</span> <span> - </span> <span class="display-name">Gabriele Petrioli</span> <span> </span> <span class="date">5 Jun 2017 at 22:18</span></td>
      </tr>
      <tr>
       <td>4</td>
       <td><span>I realize that you said CSS-only. I just want to mention that Masonry no longer requires jQuery - the minified library is <b>under 8kb</b> - and can be initialized with html alone. Just for reference <a href="https://jsfiddle.net/wp7kuk1t/" rel="nofollow noreferrer">jsfiddle.net/wp7kuk1t</a></span> <span> - </span> <span class="display-name">I haz kode</span> <span> </span> <span class="date">23 Jul 2017 at 16:59</span></td>
      </tr>
      <tr>
       <td>1</td>
       <td><span>If you can determine the height of the elements ahead of time, by knowing the line-height, font-size (you'd have to serve a specific font and do some clever calculations), image height, verticle margin and padding, you can do this. Otherwise, you cannot do this using only CSS. You could also use something like PhantomJS to pre-render each element and get the height of that element, but there would be significant overhead/latency added.</span> <span> - </span> <span class="display-name">Timothy Zorn</span> <span> </span> <span class="date">25 Jul 2017 at 07:28</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>Almost all possible masonry layouts can be found <a href="https://css-tricks.com/piecing-together-approaches-for-a-css-masonry-layout/" rel="nofollow noreferrer">here</a>. Note that there are also js solutions.</span> <span> - </span> <span class="display-name">Flimtix</span> <span> </span> <span class="date">31 Mar 2022 at 08:28</span></td>
      </tr>
     </tbody>
    </table>
   </div>
   <br>
   <div>
    <h2 id="answer_1"><span>Answer 1</span> <span class="arrow"> <a href="#answer_2">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>257</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Michael Benjamin</span>
     </div>
     <div>
      <span> Answered: </span> <span>19 Jul 2017 at 21:03</span>
     </div>
    </div>
    <div>
     <h2>2021 Update</h2>
     <p>CSS Grid Layout Level 3 includes a <code>masonry</code> feature.</p>
     <p>Code will look like this:</p>
     <pre><code>grid-template-rows: masonry
grid-template-columns: masonry
</code></pre>
     <p>As of March 2021, it's only available in Firefox (after activating the flag).</p>
     <ul>
      <li><a href="https://drafts.csswg.org/css-grid-3/#masonry-layout" rel="nofollow noreferrer">https://drafts.csswg.org/css-grid-3/#masonry-layout</a></li>
      <li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Grid_Layout/Masonry_Layout" rel="nofollow noreferrer">https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Grid_Layout/Masonry_Layout</a></li>
     </ul>
     <p><em>end update; original answer below</em></p>
     <hr>
     <h2>Flexbox</h2>
     <p>A dynamic masonry layout is not possible with flexbox, at least not in a clean and efficient way.</p>
     <p>Flexbox is a one-dimensional layout system. This means it can align items along horizontal OR vertical lines. A flex item is confined to its row or column.</p>
     <p>A true grid system is two-dimensional, meaning it can align items along horizontal AND vertical lines. Content items can span across rows and columns simultaneously, which flex items cannot do.</p>
     <p>This is why flexbox has a limited capacity for building grids. It's also a reason why the W3C has developed another CSS3 technology, <a href="https://www.w3.org/TR/css3-grid-layout/" rel="nofollow noreferrer"><strong>Grid Layout</strong></a>.</p>
     <hr>
     <h2><code>row wrap</code></h2>
     <p>In a flex container with <code>flex-flow: row wrap</code>, flex items must wrap to new <em>rows</em>.</p>
     <p>This means that <em><strong>a flex item cannot wrap under another item in the same row</strong></em>.</p>
     <p><a href="https://i.stack.imgur.com/t44yd.png" rel="nofollow noreferrer"><img src="/question/stackoverflow/44377343/t44yd.png" alt=""></a></p>
     <p>Notice above how <em>div #3</em> wraps below <em>div #1</em>, creating a new row. It cannot wrap beneath <em>div #2</em>.</p>
     <p>As a result, when items aren't the tallest in the row, white space remains, creating unsightly gaps.</p>
     <p><a href="https://i.stack.imgur.com/h3lnP.png" rel="nofollow noreferrer"><img src="/question/stackoverflow/44377343/h3lnP.png" alt=""></a></p>
     <hr>
     <h2><code>column wrap</code></h2>
     <p>If you switch to <code>flex-flow: column wrap</code>, a grid-like layout is more attainable. However, a column-direction container has four potential problems right off the bat:</p>
     <ol>
      <li>Flex items flow vertically, not horizontally (like you need in this case).</li>
      <li>The container expands horizontally, not vertically (like the Pinterest layout).</li>
      <li><a href="https://stackoverflow.com/q/42946454/3597276">It requires the container to have a fixed height, so the items know where to wrap.</a></li>
      <li>As of this writing, it has a deficiency in all major browsers where <a href="https://stackoverflow.com/q/33891709/3597276">the container doesn't expand to accommodate additional columns</a>.</li>
     </ol>
     <p>As a result, a column-direction container is not an option in this case, and in many other cases.</p>
     <hr>
     <h2>CSS Grid <em>with item dimensions undefined</em></h2>
     <p>Grid Layout would be a perfect solution to your problem <em>if the various heights of the content items could be pre-determined</em>. All other requirements are well within Grid's capacity.</p>
     <p>The width and height of grid items must be known in order to close gaps with surrounding items.</p>
     <p>So Grid, which is the best CSS has to offer for building a horizontally-flowing masonry layout, falls short in this case.</p>
     <p>In fact, until a CSS technology arrives with the ability to automatically close the gaps, CSS in general has no solution. Something like this would probably require reflowing the document, so I'm not sure how useful or efficient it would be.</p>
     <p>You'll need a script.</p>
     <p>JavaScript solutions tend to use absolute positioning, which removes content items from the document flow in order to re-arrange them with no gaps. Here are two examples:</p>
     <ul>
      <li><a href="http://masonry.desandro.com/" rel="nofollow noreferrer"><strong>Desandro Masonry</strong></a></li>
     </ul>
     <blockquote>
      <p>Masonry is a JavaScript grid layout library. It works by placing elements in optimal position based on available vertical space, sort of like a mason fitting stones in a wall.</p>
      <p><em><sup>source: <a href="http://masonry.desandro.com/" rel="nofollow noreferrer">http://masonry.desandro.com/</a></sup></em></p>
     </blockquote>
     <ul>
      <li><a href="https://benholland.me/javascript/2012/02/20/how-to-build-a-site-that-works-like-pinterest.html" rel="nofollow noreferrer"><strong>How to Build a Site that Works Like Pinterest</strong></a></li>
     </ul>
     <blockquote>
      <p>[Pinterest] really is a cool site, but what I find interesting is how these pinboards are laid out... So the purpose of this tutorial is to re-create this responsive block effect ourselves...</p>
      <p><em><sup>source: <a href="https://benholland.me/javascript/2012/02/20/how-to-build-a-site-that-works-like-pinterest.html" rel="nofollow noreferrer">https://benholland.me/javascript/2012/02/20/how-to-build-a-site-that-works-like-pinterest.html</a></sup></em></p>
     </blockquote>
     <hr>
     <h2>CSS Grid <em>with item dimensions defined</em></h2>
     <p>For layouts where the width and height of content items are known, here's a horizontally-flowing masonry layout in pure CSS:</p>
     <p></p>
     <div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
      <div class="snippet-code">
       <pre class="snippet-code-css lang-css prettyprint-override"><code>grid-container {
  display: grid;                                                /* 1 */
  grid-auto-rows: 50px;                                         /* 2 */
  grid-gap: 10px;                                               /* 3 */
  grid-template-columns: repeat(auto-fill, minmax(30%, 1fr));   /* 4 */
}

[short] {
  grid-row: span 1;                                             /* 5 */
  background-color: green;
}

[tall] {
  grid-row: span 2;
  background-color: crimson;
}

[taller] {
  grid-row: span 3;
  background-color: blue;
}

[tallest] {
  grid-row: span 4;
  background-color: gray;
}

grid-item {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3em;
  font-weight: bold;
  color: white;
}</code></pre>
       <pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;grid-container&gt;
  &lt;grid-item short&gt;01&lt;/grid-item&gt;
  &lt;grid-item short&gt;02&lt;/grid-item&gt;
  &lt;grid-item tall&gt;03&lt;/grid-item&gt;
  &lt;grid-item tall&gt;04&lt;/grid-item&gt;
  &lt;grid-item short&gt;05&lt;/grid-item&gt;
  &lt;grid-item taller&gt;06&lt;/grid-item&gt;
  &lt;grid-item short&gt;07&lt;/grid-item&gt;
  &lt;grid-item tallest&gt;08&lt;/grid-item&gt;
  &lt;grid-item tall&gt;09&lt;/grid-item&gt;
  &lt;grid-item short&gt;10&lt;/grid-item&gt;
  &lt;grid-item tallest&gt;etc.&lt;/grid-item&gt;
  &lt;grid-item tall&gt;&lt;/grid-item&gt;
  &lt;grid-item taller&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item tall&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item taller&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item tall&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item tall&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item tallest&gt;&lt;/grid-item&gt;
  &lt;grid-item taller&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
  &lt;grid-item tallest&gt;&lt;/grid-item&gt;
  &lt;grid-item tall&gt;&lt;/grid-item&gt;
  &lt;grid-item short&gt;&lt;/grid-item&gt;
&lt;/grid-container&gt;</code></pre>
      </div>
     </div>
     <p></p>
     <h2><a href="https://jsfiddle.net/q5e20knd/15/" rel="nofollow noreferrer"><strong>jsFiddle demo</strong></a></h2>
     <hr>
     <p><strong>How it works</strong></p>
     <ol>
      <li>
       <p><a href="https://www.w3.org/TR/css3-grid-layout/#grid-containers" rel="nofollow noreferrer">Establish a block-level grid container.</a> (<code>inline-grid</code> would be the other option)</p></li>
      <li>
       <p>The <a href="https://www.w3.org/TR/css3-grid-layout/#auto-tracks" rel="nofollow noreferrer"><strong><code>grid-auto-rows</code></strong></a> property sets the height of automatically generated rows. In this grid each row is 50px tall.</p></li>
      <li>
       <p>The <a href="https://www.w3.org/TR/css3-grid-layout/#gutters" rel="nofollow noreferrer"><strong><code>grid-gap</code></strong></a> property is a shorthand for <code>grid-column-gap</code> and <code>grid-row-gap</code>. This rule sets a 10px gap <em>between</em> grid items. (It doesn't apply to the area between items and the container.)</p></li>
      <li>
       <p>The <a href="https://www.w3.org/TR/css3-grid-layout/#track-sizing" rel="nofollow noreferrer"><strong><code>grid-template-columns</code></strong></a> property sets the width of explicitly defined columns.</p>
       <p>The <a href="https://www.w3.org/TR/css3-grid-layout/#repeat-notation" rel="nofollow noreferrer"><strong><code>repeat</code></strong></a> notation defines a pattern of repeating columns (or rows).</p>
       <p>The <a href="https://www.w3.org/TR/css3-grid-layout/#auto-repeat" rel="nofollow noreferrer"><strong><code>auto-fill</code></strong></a> function tells the grid to line up as many columns (or rows) as possible without overflowing the container. (This can create a similar behavior to flex layout's <code>flex-wrap: wrap</code>.)</p>
       <p>The <a href="https://www.w3.org/TR/css3-grid-layout/#valdef-grid-template-columns-minmax" rel="nofollow noreferrer"><strong><code>minmax()</code></strong></a> function sets a minimum and maximum size range for each column (or row). In the code above, the width of each column will be a minimum of 30% of the container and maximum of whatever free space is available.</p>
       <p>The <a href="https://www.w3.org/TR/css3-grid-layout/#fr-unit" rel="nofollow noreferrer"><strong><code>fr</code></strong> unit</a> represents a fraction of the free space in the grid container. It's comparable to flexbox's <code>flex-grow</code> property.</p></li>
      <li>
       <p>With <a href="https://www.w3.org/TR/css3-grid-layout/#placement-shorthands" rel="nofollow noreferrer"><strong><code>grid-row</code></strong></a> and <a href="https://www.w3.org/TR/css3-grid-layout/#common-uses-numeric" rel="nofollow noreferrer"><strong><code>span</code></strong></a> we're telling grid items how many rows they should span across.</p></li>
     </ol>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td>8</td>
        <td><span>Fantastic answer! With the "CSS Grid with item dimensions defined" solution, is it possible to express the height of a cell as a percentage of the cell width? This would be useful for displaying images, where the aspect ratio is known. We want to maintain the aspect ratio at all times.</span> <span> - </span> <span class="display-name">Oliver Joseph Ash</span> <span> </span> <span class="date">3 Jan 2018 at 16:27</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>Thanks. With respect to the aspect ratio issue for images, the "percentage of cell width" method (the percentage padding trick?), it is not reliable in Grid, or Flexbox, for that matter. See <a href="https://stackoverflow.com/q/42708323/3597276"><b>here</b></a> and <a href="https://stackoverflow.com/q/36783190/3597276"><b>here</b></a>. @OliverJosephAsh</span> <span> - </span> <span class="display-name">Michael Benjamin</span> <span> </span> <span class="date">3 Jan 2018 at 16:34</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>Yes, I am referring to the percentage padding trick. Is it possible to use any of the workarounds in combination with your masonry layout solution? For context, we are looking to implement a CSS only masonry layout for the images on <a href="https://unsplash.com" rel="nofollow noreferrer">unsplash.com</a>.</span> <span> - </span> <span class="display-name">Oliver Joseph Ash</span> <span> </span> <span class="date">3 Jan 2018 at 16:50</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>@OliverJosephAsh, the percentage padding trick, used with grid / flex items, fails in Firefox (and possibly other browsers). See the link references in my previous comment for the reasons. I would say JS is currently the safest route.</span> <span> - </span> <span class="display-name">Michael Benjamin</span> <span> </span> <span class="date">3 Jan 2018 at 17:04</span></td>
       </tr>
       <tr>
        <td>1</td>
        <td><span>Unfortunately using JS for this is not an option. We want to enable server side rendering for performance and SEO reasons. This means the layout must be rendered before client-side JavaScript has downloaded, parsed, and executed. Given this seems to be impossible, I guess we'll have to make a trade off somewhere along the line! Thanks for your help :-)</span> <span> - </span> <span class="display-name">Oliver Joseph Ash</span> <span> </span> <span class="date">3 Jan 2018 at 17:19</span></td>
       </tr>
       <tr>
        <td>2</td>
        <td><span><b>Spec Update:</b> In flexbox, percentage margins and paddings are now set to resolve again the container's inline size. <a href="https://drafts.csswg.org/css-flexbox/#item-margins" rel="nofollow noreferrer">drafts.csswg.org/css-flexbox/#item-margins</a> @OliverJosephAsh</span> <span> - </span> <span class="display-name">Michael Benjamin</span> <span> </span> <span class="date">10 May 2018 at 17:20</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>How did you arrive at the <code>30%</code> value in the <code>minmax(30%, 1fr)</code> expression? It seems arbitrary - it's not quite a third? If I use something closer to a third, it doesn't work - and if I use a lower value, things fall apart as well. How come 30% happens to work? It seems to be dependent on <code>grid-gap</code> as well - it falls apart with larger values. How would you pick the correct value for a different number of columns? Is there any way to reliably calculate this value?</span> <span> - </span> <span class="display-name">mindplay.dk</span> <span> </span> <span class="date">14 Mar 2022 at 15:54</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>As of <code>July 2022</code> no luck with the <code>masonry</code> feature being supported by any browser.</span> <span> - </span> <span class="display-name">Artur Müller Romanov</span> <span> </span> <span class="date">4 Jul 2022 at 13:01</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_2"><span>Answer 2</span> <span class="arrow"> <a href="#answer_1">↑</a> </span> <span class="arrow"> <a href="#answer_3">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>25</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Oliver Joseph Ash</span>
     </div>
     <div>
      <span> Answered: </span> <span>15 Jun 2019 at 16:33</span>
     </div>
    </div>
    <div>
     <p>This is recently discovered technique involving flexbox: <a href="https://tobiasahlin.com/blog/masonry-with-css/" rel="noreferrer">https://tobiasahlin.com/blog/masonry-with-css/</a>.</p>
     <p>The article makes sense to me, but I haven't tried to use it, so I don't know if there are any caveats, other than mentioned in Michael's answer.</p>
     <p>Here's a sample from the article, making use of the <code>order</code> property, combined with <code>:nth-child</code>.</p>
     <p>Stack snippet</p>
     <p></p>
     <div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
      <div class="snippet-code">
       <pre class="snippet-code-css lang-css prettyprint-override"><code>.container {
  display: flex;
  flex-flow: column wrap;
  align-content: space-between;
  /* Your container needs a fixed height, and it 
   * needs to be taller than your tallest column. */
  height: 960px;
  
  /* Optional */
  background-color: #f7f7f7;
  border-radius: 3px;
  padding: 20px;
  width: 60%;
  margin: 40px auto;
  counter-reset: items;
}

.item {
  width: 24%;
  /* Optional */
  position: relative;
  margin-bottom: 2%;
  border-radius: 3px;
  background-color: #a1cbfa;
  border: 1px solid #4290e2;
  box-shadow: 0 2px 2px rgba(0,90,250,0.05),
    0 4px 4px rgba(0,90,250,0.05),
    0 8px 8px rgba(0,90,250,0.05),
    0 16px 16px rgba(0,90,250,0.05);
  color: #fff;
  padding: 15px;
  box-sizing: border-box;
}

 /* Just to print out numbers */
div.item::before {
  counter-increment: items;
  content: counter(items);
}

/* Re-order items into 3 rows */
.item:nth-of-type(4n+1) { order: 1; }
.item:nth-of-type(4n+2) { order: 2; }
.item:nth-of-type(4n+3) { order: 3; }
.item:nth-of-type(4n)   { order: 4; }

/* Force new columns */
.break {
  flex-basis: 100%;
  width: 0;
  border: 1px solid #ddd;
  margin: 0;
  content: "";
  padding: 0;
}

body { font-family: sans-serif; }
h3 { text-align: center; }</code></pre>
       <pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;div class="container"&gt;
  &lt;div class="item" style="height: 140px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 190px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 170px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 120px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 160px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 180px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 140px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 150px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 170px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 170px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 140px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 190px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 170px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 120px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 160px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 180px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 140px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 150px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 170px"&gt;&lt;/div&gt;
  &lt;div class="item" style="height: 170px"&gt;&lt;/div&gt;
  
  &lt;span class="item break"&gt;&lt;/span&gt;
  &lt;span class="item break"&gt;&lt;/span&gt;
  &lt;span class="item break"&gt;&lt;/span&gt;
&lt;/div&gt;</code></pre>
      </div>
     </div>
     <p></p>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td>1</td>
        <td><span>First off, link only answers is bad ones, as when such link dies, so does the answer. Second, if you read the given answer more carefully, you'll find what's mentioned in your link is covered. Simply put, there are too many limitations using Flexbox alone, unless what is mentioned above is not an issue.</span> <span> - </span> <span class="display-name">Asons</span> <span> </span> <span class="date">15 Jun 2019 at 17:45</span></td>
       </tr>
       <tr>
        <td>4</td>
        <td><span>I have read the accepted answer very thoroughly—you'll even see some comments I added to the bottom of it. The flexbox approach I linked to is unique and not covered by that answer. I don't want to repeat the article, because it's very complicated, and the article does a great job of covering that.</span> <span> - </span> <span class="display-name">Oliver Joseph Ash</span> <span> </span> <span class="date">15 Jun 2019 at 18:22</span></td>
       </tr>
       <tr>
        <td>1</td>
        <td><span>The only thing that the linked does different is making use of the <code>order</code> property, making it look like items flows from left to right. Still, its main trick is <code>flex-flow: column wrap</code>, which is mentioned in the above answer. In addition, it can't flow the items in the way a real masonry does, e.g. if the 3rd and 4th item would fit in the 3rd column, they would, the linked one doesn't. But again as I said, it all depends on what the requirements are, and in this case (this question), it won't work as what asked for.</span> <span> - </span> <span class="display-name">Asons</span> <span> </span> <span class="date">15 Jun 2019 at 18:39</span></td>
       </tr>
       <tr>
        <td>1</td>
        <td><span>Furthermore, it is not about <i>"you don't want to repeat the article"</i>, an answer should contain the essential part of the code, so it will still be valid when the linked resource dies.</span> <span> - </span> <span class="display-name">Asons</span> <span> </span> <span class="date">15 Jun 2019 at 18:41</span></td>
       </tr>
       <tr>
        <td>1</td>
        <td><span>Fair points. I thought it would be useful to share this article here anyway, since it builds upon the other techniques mentioned previously, and whilst it doesn't answer the original question, it might help others for whom these limitations are acceptable. I'm happy to delete my answer and re-share the link as a comment, noting the key difference (<code>order</code>).</span> <span> - </span> <span class="display-name">Oliver Joseph Ash</span> <span> </span> <span class="date">15 Jun 2019 at 18:48</span></td>
       </tr>
       <tr>
        <td>1</td>
        <td><span>It is useful, though as a link alone, do it as a comment, if you edit in the code, keep it as an answer.</span> <span> - </span> <span class="display-name">Asons</span> <span> </span> <span class="date">15 Jun 2019 at 18:50</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>This answer needs the flex element to be a fixed height, so it's a bit useless with dynamic content.</span> <span> - </span> <span class="display-name">Gavin</span> <span> </span> <span class="date">10 May 2022 at 10:45</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_3"><span>Answer 3</span> <span class="arrow"> <a href="#answer_2">↑</a> </span> <span class="arrow"> <a href="#answer_4">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>4</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Temani Afif</span>
     </div>
     <div>
      <span> Answered: </span> <span>3 Mar 2021 at 12:54</span>
     </div>
    </div>
    <div>
     <p>Finally a CSS-only solution to easily create masonry layout but we need to be patient since there is no support for it for now.</p>
     <p>This feature was introduced in the <a href="https://drafts.csswg.org/css-grid-3/#masonry-layout" rel="nofollow noreferrer">CSS Grid Layout Module Level 3</a></p>
     <blockquote>
      <p>This module introduces masonry layout as an additional layout mode for CSS Grid containers.</p>
     </blockquote>
     <p>Then</p>
     <blockquote>
      <p>Masonry layout is supported for grid containers by specifying the value <strong>masonry</strong> for one of its axes. This axis is called the masonry axis, and the other axis is called the grid axis.</p>
     </blockquote>
     <p>A basic example would be:</p>
     <p></p>
     <div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
      <div class="snippet-code">
       <pre class="snippet-code-css lang-css prettyprint-override"><code>.container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  grid-template-rows: masonry; /* this will do the magic */
  grid-gap: 10px;
}

img {
  width: 100%;
}</code></pre>
       <pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;div class="container"&gt;
  &lt;img src="https://picsum.photos/id/1/200/300"&gt;
  &lt;img src="https://picsum.photos/id/17/200/400"&gt;
  &lt;img src="https://picsum.photos/id/18/200/100"&gt;
  &lt;img src="https://picsum.photos/id/107/200/200"&gt;
  &lt;img src="https://picsum.photos/id/1069/200/600"&gt;
  &lt;img src="https://picsum.photos/id/12/200/200"&gt;
  &lt;img src="https://picsum.photos/id/130/200/100"&gt;
  &lt;img src="https://picsum.photos/id/203/200/100"&gt;
  &lt;img src="https://picsum.photos/id/109/200/200"&gt;
  &lt;img src="https://picsum.photos/id/11/200/100"&gt;
&lt;/div&gt;</code></pre>
      </div>
     </div>
     <p></p>
     <p>This will produce the following result on Firefox if you enable the feature like explained here: <a href="https://caniuse.com/?search=masonry" rel="nofollow noreferrer">https://caniuse.com/?search=masonry</a></p>
     <ol>
      <li>open Firefox and write about:config in the url bar</li>
      <li>do a search using masonry</li>
      <li>you will get one flag, make it true</li>
     </ol>
     <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--s3B_b6Oo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/62rhe663hibtkav5u6lk.png" alt=""></p>
     <p><a href="https://i.stack.imgur.com/hOzbA.jpg" rel="nofollow noreferrer"><img src="/question/stackoverflow/44377343/hOzbA.jpg" alt="CSS masonry layout"></a></p>
     <p>If we reduce the screen screen, the reponsive part is perfect!</p>
     <p><a href="https://i.stack.imgur.com/wuCzH.jpg" rel="nofollow noreferrer"><img src="/question/stackoverflow/44377343/wuCzH.jpg" alt="Masonry layout using CSS only"></a></p>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_4"><span>Answer 4</span> <span class="arrow"> <a href="#answer_3">↑</a> </span> <span class="arrow"> <a href="#answer_5">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>4</span>
     </div>
     <div>
      <span>Answerer: </span> <span>نور</span>
     </div>
     <div>
      <span> Answered: </span> <span>7 Dec 2021 at 12:02</span>
     </div>
    </div>
    <div>
     <p>I find This solution, It is most probably compatible with all browsers.</p>
     <p><strong>Note: if anyone finds any error or browser support issues. please update this answer Or comments</strong></p>
     <p><strong>CSS Profpery Support reference:</strong></p>
     <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/column-count" rel="nofollow noreferrer">column-count, gap, fill</a> <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/break-inside" rel="nofollow noreferrer">break-inside</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/page-break-inside" rel="nofollow noreferrer">page-break-inside</a></p>
     <p>Note: <code>page-break-inside</code> This property has been replaced by the <code>break-inside</code> property.</p>
     <p></p>
     <div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
      <div class="snippet-code">
       <pre class="snippet-code-css lang-css prettyprint-override"><code>  

.container {
  -moz-column-count: 1;
       column-count: 1;
  -moz-column-gap: 20px;
       column-gap: 20px;
  -moz-column-fill: balance;
       column-fill: balance;
  margin: 20px auto 0;
  padding: 2rem;
}
.container .item {
  display: inline-block;
  margin: 0 0 20px;
  page-break-inside: avoid;
  -moz-column-break-inside: avoid;
       break-inside: avoid;
  width: 100%;
}
.container .item img {
  width: 100%;
  height: auto;
}
@media (min-width: 600px) {
  .container {
    -moz-column-count: 2;
         column-count: 2;
  }
}
@media (min-width: 900px) {
  .container {
    -moz-column-count: 3;
         column-count: 3;
  }
}
@media (min-width: 1200px) {
  .container {
    -moz-column-count: 4;
         column-count: 4;
  }
}</code></pre>
       <pre class="snippet-code-html lang-html prettyprint-override"><code>   
 CSS-Only Masonry Layout 
  
&lt;div class="container"&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/400/animals" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/600/arch" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/300/nature" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/450/people" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/350/tech" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/800/animals/grayscale" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/650/arch/sepia" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/300/nature/grayscale" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/400/people/sepia" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/600/tech/grayscale" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/200/animals/sepia" alt=""&gt;&lt;/div&gt;
  &lt;div class="item"&gt;&lt;img src="https://placeimg.com/600/700/arch/grayscale" alt=""&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>
      </div>
     </div>
     <p></p>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td>2</td>
        <td><span>Yeah but if you read the question the goal was to achieve this row-wise. The OP already knew the column-wise solution, which is easy.</span> <span> - </span> <span class="display-name">Saifur Rahman Mohsin</span> <span> </span> <span class="date">16 Dec 2022 at 08:31</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>Perhaps some explanation and compatibility comments</span> <span> - </span> <span class="display-name">mplungjan</span> <span> </span> <span class="date">25 Jan 2023 at 09:12</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>@mplungjan all browser supports it. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/column-count" rel="nofollow noreferrer">column-count, gap, fill</a> <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/break-inside" rel="nofollow noreferrer">break-inside</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/page-break-inside" rel="nofollow noreferrer">page-break-inside</a> Note: This property has been replaced by the break-inside property.</span> <span> - </span> <span class="display-name">نور</span> <span> </span> <span class="date">25 Jan 2023 at 10:16</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>So please update your answer with this information</span> <span> - </span> <span class="display-name">mplungjan</span> <span> </span> <span class="date">25 Jan 2023 at 10:17</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_5"><span>Answer 5</span> <span class="arrow"> <a href="#answer_4">↑</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>1</span>
     </div>
     <div>
      <span>Answerer: </span> <span>GorvGoyl</span>
     </div>
     <div>
      <span> Answered: </span> <span>19 Apr 2023 at 10:00</span>
     </div>
    </div>
    <div>
     <p>here's the responsive way using css <code>columns</code>.<br>
       Note: elements are ordered by column and not by row.</p>
     <pre class="lang-html prettyprint-override"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;link rel="stylesheet" href="styles.css"&gt;
    &lt;title&gt;Responsive Grid Layout&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="wrapper"&gt;
        &lt;div class="box box1"&gt;Content of box 1&lt;/div&gt;
        &lt;div class="box box2"&gt;Content of box 2&lt;/div&gt;
        &lt;div class="box box3"&gt;Content of box 3&lt;/div&gt;
        &lt;div class="box box4"&gt;Content of box 4&lt;/div&gt;
        &lt;div class="box box5"&gt;Content of box 5&lt;/div&gt;
        &lt;div class="box box6"&gt;Content of box 6&lt;/div&gt;
        &lt;div class="box box7"&gt;Content of box 7&lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
     <pre class="lang-css prettyprint-override"><code>body {
    margin: 0;
    display: flex;
    justify-content: center;
}

.wrapper {
  column-count: auto;
  column-width: 320px; /* 300px + 20px gap */
  column-gap: 20px;
  width: 100%;
  max-width: 1000px;
  padding: 20px;
  box-sizing: border-box;
}

.box {
  background-color: lightblue;
  border: 1px solid blue;
  padding: 20px;
  font-size: 1.5em;
  text-align: center;
  width: 300px;
  box-sizing: border-box;
  display: inline-block;
  margin-bottom: 20px;
  break-inside: avoid-column;
}

.box1 {
  height: 800px;
}
.box2 {
  height: 300px;
}
.box3 {
  height: 300px;
}
.box4 {
  height: 300px;
}
</code></pre>
     <p><a href="https://i.stack.imgur.com/thL8K.png" rel="nofollow noreferrer"><img src="/question/stackoverflow/44377343/thL8K.png" alt="enter image description here"></a></p>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <br>
   <div>
    <span>License: </span> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <span>by </span> <a href="https://stackoverflow.com/legal/terms-of-service#licensing">Stack Overflow Inc.</a>
   </div>
  </div>
 </body>
</html>