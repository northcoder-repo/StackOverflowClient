<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>How can I upload files to a server using JSP/Servlet?</title>
  <link rel="stylesheet" type="text/css" href="/css/base.css">
  <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
            TeX: {
            extensions: ["begingroup.js"],
            noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
            Macros: { href: "{}" }
            },
            messageStyle: "none",
            styles: { ".MathJax_Display, .MathJax_Preview, .MathJax_Preview > *": { "background": "inherit" } },
            SEEditor: "mathjaxEditing"
            });
        </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full"></script>
 </head>
 <body>
  <div class="question">
   <a href="/questions">All Questions</a>
   <h2>How can I upload files to a server using JSP/Servlet?</h2>
   <div class="container-metadata">
    <div>
     <span>Score: </span> <span>717</span>
    </div>
    <div>
     <span>Asker: </span> <span>Thang Pham</span>
    </div>
    <div>
     <span>Asked: </span> <span>11 Mar 2010 at 04:07</span>
    </div>
    <div>
     <a href="https://stackoverflow.com/questions/2422468/how-can-i-upload-files-to-a-server-using-jsp-servlet">source</a>
    </div>
   </div>
   <div>
    <p>How can I upload files to server using JSP/Servlet?</p>
    <p>I tried this:</p>
    <pre class="lang-html prettyprint-override"><code>&lt;form action="upload" method="post"&gt;
    &lt;input type="text" name="description" /&gt;
    &lt;input type="file" name="file" /&gt;
    &lt;input type="submit" /&gt;
&lt;/form&gt;
</code></pre>
    <p>However, I only get the file name, not the file content. When I add <code>enctype="multipart/form-data"</code> to the <code>&lt;form&gt;</code>, then <code>request.getParameter()</code> returns <code>null</code>.</p>
    <p>During research I stumbled upon <a href="http://commons.apache.org/fileupload" rel="noreferrer">Apache Common FileUpload</a>. I tried this:</p>
    <pre><code>FileItemFactory factory = new DiskFileItemFactory();
ServletFileUpload upload = new ServletFileUpload(factory);
List items = upload.parseRequest(request); // This line is where it died.
</code></pre>
    <p>Unfortunately, the servlet threw an exception without a clear message and cause. Here is the stacktrace:</p>
    <pre class="lang-none prettyprint-override"><code>SEVERE: Servlet.service() for servlet UploadServlet threw exception
javax.servlet.ServletException: Servlet execution threw an exception
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:313)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)
    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:852)
    at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)
    at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)
    at java.lang.Thread.run(Thread.java:637)
</code></pre>
   </div>
   <div class="tags">
    <span class="tag">java</span><span class="tag">jsp</span><span class="tag">jakarta-ee</span><span class="tag">servlets</span><span class="tag">file-upload</span>
   </div>
   <hr>
   <div class="comment">
    <table>
     <tbody>
      <tr>
       <td></td>
       <td><span>Perhaps this article will be helpful: <a href="https://www.baeldung.com/upload-file-servlet" rel="nofollow noreferrer">baeldung.com/upload-file-servlet</a></span> <span> - </span> <span class="display-name">Adam Gerard</span> <span> </span> <span class="date">15 Jan 2019 at 04:31</span></td>
      </tr>
      <tr>
       <td>1</td>
       <td><span>@Adam: They copied from my answer and added a sleuth of advertising on top of it in an attempt to earn money with it. Yeah, great article ..</span> <span> - </span> <span class="display-name">BalusC</span> <span> </span> <span class="date">24 Feb 2021 at 11:24</span></td>
      </tr>
      <tr>
       <td>1</td>
       <td><span>No, actually nothing was copied. I wrote the first draft of that article along with the supplemental code. The core reference documentation can be found here: <a href="https://commons.apache.org/proper/commons-fileupload/using.html" rel="nofollow noreferrer">commons.apache.org/proper/commons-fileupload/using.html</a> (and is linked to and cited in the article). Examples are partly reprised from the core reference document (which is the point of reference documentation - i.e. to be a point of reference) but not in their entirety (note that the reference docs don't go into much detail). Thanks!</span> <span> - </span> <span class="display-name">Adam Gerard</span> <span> </span> <span class="date">29 Mar 2021 at 15:33</span></td>
      </tr>
      <tr>
       <td></td>
       <td><span>check this <a href="https://sandny.com/2017/05/18/servlet-file-upload" rel="nofollow noreferrer">sandny.com/2017/05/18/servlet-file-upload</a></span> <span> - </span> <span class="display-name">ricky</span> <span> </span> <span class="date">26 Jul 2021 at 16:50</span></td>
      </tr>
     </tbody>
    </table>
   </div>
   <br>
   <div>
    <h2 id="answer_1"><span>Answer 1</span> <span class="arrow"> <a href="#answer_2">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>1251</span>
     </div>
     <div>
      <span>Answerer: </span> <span>BalusC</span>
     </div>
     <div>
      <span> Answered: </span> <span>11 Mar 2010 at 12:27</span>
     </div>
    </div>
    <div>
     <h2>Introduction</h2>
     <p>To browse and select a file for upload you need a HTML <code>&lt;input type="file"&gt;</code> field in the form. As stated in the <a href="http://www.w3.org/TR/html4/interact/forms.html" rel="noreferrer">HTML specification</a> you have to use the <code>POST</code> method and the <code>enctype</code> attribute of the form has to be set to <code>"multipart/form-data"</code>.</p>
     <pre class="lang-html prettyprint-override"><code>&lt;form action="upload" method="post" enctype="multipart/form-data"&gt;
    &lt;input type="text" name="description" /&gt;
    &lt;input type="file" name="file" /&gt;
    &lt;input type="submit" /&gt;
&lt;/form&gt;
</code></pre>
     <p>After submitting such a form, the binary multipart form data is available in the request body in <a href="https://stackoverflow.com/questions/13372775/servlet-handling-file-upload-why-bigger-than-the-original/13399437#13399437">a different format</a> than when the <code>enctype</code> isn't set.</p>
     <p>Before Servlet 3.0 (Dec 2009), the Servlet API didn't natively support <code>multipart/form-data</code>. It supports only the default form enctype of <code>application/x-www-form-urlencoded</code>. The <code>request.getParameter()</code> and consorts would all return <code>null</code> when using multipart form data. This is where the well known <a href="http://commons.apache.org/fileupload" rel="noreferrer">Apache Commons FileUpload</a> came into the picture.</p>
     <h2>Don't manually parse it!</h2>
     <p>You can in theory parse the request body yourself based on <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletRequest.html#getInputStream%28%29" rel="noreferrer"><code>ServletRequest#getInputStream()</code></a>. However, this is a precise and tedious work which requires precise knowledge of <a href="http://www.faqs.org/rfcs/rfc2388.html" rel="noreferrer">RFC2388</a>. You shouldn't try to do this on your own or copypaste some homegrown library-less code found elsewhere on the Internet. Many online sources have failed hard in this, such as roseindia.net. See also <a href="https://stackoverflow.com/questions/5038798/uploading-of-pdf-file">uploading of pdf file</a>. You should rather use a real library which is used (and implicitly tested!) by millions of users for years. Such a library has proven its robustness.</p>
     <h2>When you're already on Servlet 3.0 or newer, use native API</h2>
     <p>If you're using at least Servlet 3.0 (Tomcat 7, Jetty 9, JBoss AS 6, GlassFish 3, etc, they exist already since 2010), then you can just use standard API provided <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletRequest.html#getParts()" rel="noreferrer"><code>HttpServletRequest#getPart()</code></a> to collect the individual multipart form data items (most Servlet 3.0 implementations <em>actually</em> use Apache Commons FileUpload under the covers for this!). Also, normal form fields are available by <code>getParameter()</code> the usual way.</p>
     <p>First annotate your servlet with <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/annotation/MultipartConfig.html" rel="noreferrer"><code>@MultipartConfig</code></a> in order to let it recognize and support <code>multipart/form-data</code> requests and thus get <code>getPart()</code> to work:</p>
     <pre><code>@WebServlet("/upload")
@MultipartConfig
public class UploadServlet extends HttpServlet {
    // ...
}
</code></pre>
     <p>Then, implement its <code>doPost()</code> as follows:</p>
     <pre class="lang-java prettyprint-override"><code>protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    String description = request.getParameter("description"); // Retrieves &lt;input type="text" name="description"&gt;
    Part filePart = request.getPart("file"); // Retrieves &lt;input type="file" name="file"&gt;
    String fileName = Paths.get(filePart.getSubmittedFileName()).getFileName().toString(); // MSIE fix.
    InputStream fileContent = filePart.getInputStream();
    // ... (do your job here)
}
</code></pre>
     <p>Note the <code>Path#getFileName()</code>. This is a MSIE fix as to obtaining the file name. This browser incorrectly sends the full file path along the name instead of only the file name.</p>
     <p>In case you want to upload multiple files via either <code>multiple="true"</code>,</p>
     <pre class="lang-html prettyprint-override"><code>&lt;input type="file" name="files" multiple="true" /&gt;
</code></pre>
     <p>or the old-fashioned way with multiple inputs,</p>
     <pre class="lang-html prettyprint-override"><code>&lt;input type="file" name="files" /&gt;
&lt;input type="file" name="files" /&gt;
&lt;input type="file" name="files" /&gt;
...
</code></pre>
     <p>then you can collect them as below (unfortunately there is no such method as <code>request.getParts("files")</code>):</p>
     <pre><code>protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // ...
    List&lt;Part&gt; fileParts = request.getParts().stream().filter(part -&gt; "files".equals(part.getName()) &amp;&amp; part.getSize() &gt; 0).collect(Collectors.toList()); // Retrieves &lt;input type="file" name="files" multiple="true"&gt;

    for (Part filePart : fileParts) {
        String fileName = Paths.get(filePart.getSubmittedFileName()).getFileName().toString(); // MSIE fix.
        InputStream fileContent = filePart.getInputStream();
        // ... (do your job here)
    }
}
</code></pre>
     <h2>When you're not on Servlet 3.1 yet, manually get submitted file name</h2>
     <p>Note that <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/Part.html#getSubmittedFileName()" rel="noreferrer"><code>Part#getSubmittedFileName()</code></a> was introduced in Servlet 3.1 (Tomcat 8, Jetty 9, WildFly 8, GlassFish 4, etc, they exist since 2013 already). If you're not on Servlet 3.1 yet (really?), then you need an additional utility method to obtain the submitted file name.</p>
     <pre><code>private static String getSubmittedFileName(Part part) {
    for (String cd : part.getHeader("content-disposition").split(";")) {
        if (cd.trim().startsWith("filename")) {
            String fileName = cd.substring(cd.indexOf('=') + 1).trim().replace("\"", "");
            return fileName.substring(fileName.lastIndexOf('/') + 1).substring(fileName.lastIndexOf('\\') + 1); // MSIE fix.
        }
    }
    return null;
}
</code></pre>
     <pre><code>String fileName = getSubmittedFileName(filePart);
</code></pre>
     <p>Note the MSIE fix as to obtaining the file name. This browser incorrectly sends the full file path along the name instead of only the file name.</p>
     <h2>When you're not on Servlet 3.0 yet, use Apache Commons FileUpload</h2>
     <p>If you're not on Servlet 3.0 yet (isn't it about time to upgrade? it's released over a decade ago!), the common practice is to make use of <a href="http://commons.apache.org/fileupload" rel="noreferrer">Apache Commons FileUpload</a> to parse the multpart form data requests. It has an excellent <a href="http://commons.apache.org/fileupload/using.html" rel="noreferrer">User Guide</a> and <a href="http://commons.apache.org/fileupload/faq.html" rel="noreferrer">FAQ</a> (carefully go through both). There's also the O'Reilly ("<a href="http://www.servlets.com/cos/" rel="noreferrer">cos</a>") <code>MultipartRequest</code>, but it has some (minor) bugs and isn't actively maintained anymore for years. I wouldn't recommend using it. Apache Commons FileUpload is still actively maintained and currently very mature.</p>
     <p>In order to use Apache Commons FileUpload, you need to have at least the following files in your webapp's <code>/WEB-INF/lib</code>:</p>
     <ul>
      <li><a href="http://commons.apache.org/proper/commons-fileupload/download_fileupload.cgi" rel="noreferrer"><code>commons-fileupload.jar</code></a></li>
      <li><a href="http://commons.apache.org/proper/commons-io/download_io.cgi" rel="noreferrer"><code>commons-io.jar</code></a></li>
     </ul>
     <p>Your initial attempt failed most likely because you forgot the commons IO.</p>
     <p>Here's a kickoff example how the <code>doPost()</code> of your <code>UploadServlet</code> may look like when using Apache Commons FileUpload:</p>
     <pre class="lang-java prettyprint-override"><code>protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    try {
        List&lt;FileItem&gt; items = new ServletFileUpload(new DiskFileItemFactory()).parseRequest(request);
        for (FileItem item : items) {
            if (item.isFormField()) {
                // Process regular form field (input type="text|radio|checkbox|etc", select, etc).
                String fieldName = item.getFieldName();
                String fieldValue = item.getString();
                // ... (do your job here)
            } else {
                // Process form file field (input type="file").
                String fieldName = item.getFieldName();
                String fileName = FilenameUtils.getName(item.getName());
                InputStream fileContent = item.getInputStream();
                // ... (do your job here)
            }
        }
    } catch (FileUploadException e) {
        throw new ServletException("Cannot parse multipart request.", e);
    }

    // ...
}
</code></pre>
     <p>It's very important that you don't call <code>getParameter()</code>, <code>getParameterMap()</code>, <code>getParameterValues()</code>, <code>getInputStream()</code>, <code>getReader()</code>, etc on the same request beforehand. Otherwise the servlet container will read and parse the request body and thus Apache Commons FileUpload will get an empty request body. See also a.o. <a href="https://stackoverflow.com/questions/13881272/servletfileuploadparserequestrequest-returns-an-empty-list">ServletFileUpload#parseRequest(request) returns an empty list</a>.</p>
     <p>Note the <code>FilenameUtils#getName()</code>. This is a MSIE fix as to obtaining the file name. This browser incorrectly sends the full file path along the name instead of only the file name.</p>
     <p>Alternatively you can also wrap this all in a <code>Filter</code> which parses it all automagically and put the stuff back in the parametermap of the request so that you can continue using <code>request.getParameter()</code> the usual way and retrieve the uploaded file by <code>request.getAttribute()</code>. <a href="http://balusc.blogspot.com/2007/11/multipartfilter.html" rel="noreferrer">You can find an example in this blog article</a>.</p>
     <h2>Workaround for GlassFish3 bug of <code>getParameter()</code> still returning <code>null</code></h2>
     <p>Note that Glassfish versions older than 3.1.2 had <a href="http://java.net/jira/browse/GLASSFISH-16740" rel="noreferrer">a bug</a> wherein the <code>getParameter()</code> still returns <code>null</code>. If you are targeting such a container and can't upgrade it, then you need to extract the value from <code>getPart()</code> with help of this utility method:</p>
     <pre><code>private static String getValue(Part part) throws IOException {
    BufferedReader reader = new BufferedReader(new InputStreamReader(part.getInputStream(), "UTF-8"));
    StringBuilder value = new StringBuilder();
    char[] buffer = new char[1024];
    for (int length = 0; (length = reader.read(buffer)) &gt; 0;) {
        value.append(buffer, 0, length);
    }
    return value.toString();
}
</code></pre>
     <pre><code>String description = getValue(request.getPart("description")); // Retrieves &lt;input type="text" name="description"&gt;
    
</code></pre>
     <h2>Saving uploaded file (don't use <code>getRealPath()</code> nor <code>part.write()</code>!)</h2>
     <p>Head to the following answers for detail on properly saving the obtained <code>InputStream</code> (the <code>fileContent</code> variable as shown in the above code snippets) to disk or database:</p>
     <ul>
      <li><a href="https://stackoverflow.com/questions/18664579/recommended-way-to-save-files-uploaded-to-a-tomcat-servlet/18664715#18664715">Recommended way to save uploaded files in a servlet application</a></li>
      <li><a href="https://stackoverflow.com/questions/7033676/how-to-upload-an-image-and-save-it-in-database/7033945#7033945">How to upload an image and save it in database?</a></li>
      <li><a href="https://stackoverflow.com/questions/19138706/how-to-convert-part-to-blob-so-i-can-store-it-in-mysql/19139125#19139125">How to convert Part to Blob, so I can store it in MySQL?</a></li>
     </ul>
     <h2>Serving uploaded file</h2>
     <p>Head to the following answers for detail on properly serving the saved file from disk or database back to the client:</p>
     <ul>
      <li><a href="https://stackoverflow.com/questions/4543936/load-images-from-outside-of-webapps-webcontext-deploy-folder-using-hgraphi/4543951#4543951">Load images from outside of webapps / webcontext / deploy folder using &lt;h:graphicImage&gt; or &lt;img&gt; tag</a></li>
      <li><a href="https://stackoverflow.com/questions/2340406/how-to-retrieve-and-display-images-from-a-database-in-a-jsp-page/2341322#2341322">How to retrieve and display images from a database in a JSP page?</a></li>
      <li><a href="https://stackoverflow.com/questions/1812244/simplest-way-to-serve-static-data-from-outside-the-application-server-in-a-java/1812356#1812356">Simplest way to serve static data from outside the application server in a Java web application</a></li>
      <li><a href="https://stackoverflow.com/questions/132052/servlet-for-serving-static-content/29991447#29991447">Abstract template for static resource servlet supporting HTTP caching</a></li>
     </ul>
     <h2>Ajaxifying the form</h2>
     <p>Head to the following answers how to upload using Ajax (and jQuery). Do note that the servlet code to collect the form data does not need to be changed for this! Only the way how you respond may be changed, but this is rather trivial (i.e. instead of forwarding to JSP, just print some JSON or XML or even plain text depending on whatever the script responsible for the Ajax call is expecting).</p>
     <ul>
      <li><a href="https://stackoverflow.com/questions/6914152/how-to-upload-files-to-server-using-jsp-servlet-and-ajax">How can I upload files to a server using JSP/Servlet and Ajax?</a></li>
      <li><a href="https://stackoverflow.com/questions/9395911/sending-a-file-as-multipart-through-xmlhttprequest">Send a file as multipart through XMLHttpRequest</a></li>
      <li><a href="https://stackoverflow.com/questions/7114087/html5-file-upload-to-java-servlet">HTML5 drag and drop file upload to Java Servlet</a></li>
     </ul>
     <hr>
     <p>Hope this all helps :)</p>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>Ah sorry, I was seeing <code>request.getParts("file")</code> and was confused x_x</span> <span> - </span> <span class="display-name">Kagami Sascha Rosylight</span> <span> </span> <span class="date">5 Nov 2016 at 22:02</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>With Servlet 3.0, if a <code>MultipartConfig</code> condition is violated (eg: <code>maxFileSize</code>), calling <code>request.getParameter()</code> returns null. Is this on purpose? What if I get some regular (text) parameters before calling <code>getPart</code> (and checking for an <code>IllegalStateException</code>)? This causes a <code>NullPointerException</code> to be thrown before I have a chance to check for the <code>IllegalStateException</code>.</span> <span> - </span> <span class="display-name">theyuv</span> <span> </span> <span class="date">20 Nov 2016 at 14:34</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>@BalusC I created a post related to this, do you have an idea how I could retrieve extra infos from File API webKitDirectory. More details here <a href="https://stackoverflow.com/questions/45419598/retrieve-uploaded-relativepath-file-on-server-side" title="retrieve uploaded relativepath file on server side">stackoverflow.com/questions/45419598/…</a></span> <span> - </span> <span class="display-name">Rapster</span> <span> </span> <span class="date">31 Jul 2017 at 23:52</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>If you aren't on Servlet 3.0 and use the FileUpload trick, I found you can't read the file from the request more than once. If you need this functionality, you might want to look at Spring's MultiPartFilter. This post has a good working example: <a href="https://stackoverflow.com/a/21448087/1048376">stackoverflow.com/a/21448087/1048376</a></span> <span> - </span> <span class="display-name">splashout</span> <span> </span> <span class="date">21 Nov 2017 at 23:09</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>Answer is misleading in "When you're already on Servlet 3.0 or newer" section, because according to docs <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/Part.html#getSubmittedFileName--" rel="nofollow noreferrer">getSubmittedFileName</a> method is available in Part interface since servlet spec 3.1, tomcat 8+ supports 3.1 specification.</span> <span> - </span> <span class="display-name">raviraja</span> <span> </span> <span class="date">24 Sep 2018 at 13:08</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>@raviraja: That's correct. See "When you're not on Servlet 3.1 yet, manually get submitted file name" section of the answer.</span> <span> - </span> <span class="display-name">BalusC</span> <span> </span> <span class="date">24 Sep 2018 at 13:14</span></td>
       </tr>
       <tr>
        <td>1</td>
        <td><span>Yeah, if someone tries to use the code in 3.0 section with tomcat 7, they might face issue in <code>String fileName = Paths.get(filePart.getSubmittedFileName()).getFileName().toS‌​tring(); // MSIE fix.</code>part similar to me</span> <span> - </span> <span class="display-name">raviraja</span> <span> </span> <span class="date">24 Sep 2018 at 13:24</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>In IE/Edge, getSubmittedFileName removes slashes from the full path. How to fix that?</span> <span> - </span> <span class="display-name">Peng</span> <span> </span> <span class="date">6 Jan 2020 at 13:56</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>@Peng: Not. That's the correct behavior. The browser should not send the full path at all but only the file name. All other browsers are doing it correctly. Only IE/Edge incorrectly sends the full client side path along which is a security leak.</span> <span> - </span> <span class="display-name">BalusC</span> <span> </span> <span class="date">6 Jan 2020 at 13:59</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>@BalusC Your MSIE fix Paths.get(filePart.getSubmittedFileName()).getFileName().toS‌​tring(); successfully fix the security issue by removing the full path except the file name. But what I found in IE11 and Edge 44.18362.449 is another issue: getSubmittedFileName itself already removes all slashes in the full path. For example, for the full path C:\temp\file.txt, getSubmittedFileName gives me C:tempfile.txt. So your fix code would give me C:tempfile.txt rather than file.txt.</span> <span> - </span> <span class="display-name">Peng</span> <span> </span> <span class="date">6 Jan 2020 at 14:29</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>We can also disable IE from sending the full path: Internet Options &gt; Security &gt; Internet &gt; Custom Level &gt; disable "Include local directory path when uploading files to server”.</span> <span> - </span> <span class="display-name">Peng</span> <span> </span> <span class="date">6 Jan 2020 at 17:06</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span><i>"getSubmittedFileName itself already removes all slashes in the full path"</i> this is new to me. Apparently it depends on the server make/version being used. <i>"For example, for the full path C:\temp\file.txt, getSubmittedFileName gives me C:tempfile.txt"</i> this is definitely a bug in the server being used. Report it to them. <i>"We can also disable IE from sending the full path"</i> this is not wise to assume. We may not rely on every enduser of your webapp doing that. Ignore that and fix in server side instead.</span> <span> - </span> <span class="display-name">BalusC</span> <span> </span> <span class="date">6 Jan 2020 at 17:35</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>after adding <code>reguest.getParameter("password")</code> I am getting a strange FileNotFoundException...</span> <span> - </span> <span class="display-name">user12465043</span> <span> </span> <span class="date">6 Apr 2020 at 15:37</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>@AndroidAnton: Provided that you're using Servlet 3.0 or newer, then you're supposed to obtain the uploaded file via request.getPart() as explained in the answer, not via other ways, and very definitely not via Commons FileUpload. That's only needed when you're not on Servlet 3.0 yet, as explained in the answer.</span> <span> - </span> <span class="display-name">BalusC</span> <span> </span> <span class="date">6 Apr 2020 at 17:15</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>I'm working on servlet 2.3(had no choice) so I tried the method mentioned your blog. It works well if the uploaded file type is .txt. When i tried upload pdf &amp; outlook item, they appeared in "C:/upload" folder but unable to open. <code>It was not supported file type or file has been damaged</code>. Any idea how I can solve this?</span> <span> - </span> <span class="display-name">aaa</span> <span> </span> <span class="date">1 Apr 2021 at 09:21</span></td>
       </tr>
       <tr>
        <td>2</td>
        <td><span>@aaa: that can happen when you converted bytes to characters by using a <code>Reader</code> and/or <code>Writer</code> for unclear reason. Do not do that. Use <code>InputStream</code>/<code>OutputStream</code> over all place during reading and writing an uploaded file without massaging bytes into characters. A PDF file is not a character based text file or so. It is a binary file.</span> <span> - </span> <span class="display-name">BalusC</span> <span> </span> <span class="date">1 Apr 2021 at 10:01</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>Is this (<code>request.getPart(name)</code>) also valid to use with Spring 2.7 and servlet 3.0?</span> <span> - </span> <span class="display-name">Sam</span> <span> </span> <span class="date">14 Mar 2023 at 17:43</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_2"><span>Answer 2</span> <span class="arrow"> <a href="#answer_1">↑</a> </span> <span class="arrow"> <a href="#answer_3">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>26</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Amila</span>
     </div>
     <div>
      <span> Answered: </span> <span>26 Aug 2015 at 12:39</span>
     </div>
    </div>
    <div>
     <p>If you happen to use <a href="https://en.wikipedia.org/wiki/Spring_Framework#Model-view-controller_framework" rel="nofollow noreferrer">Spring MVC</a>, this is how to (I'm leaving this here in case someone find it useful):</p>
     <p>Use a form with <code>enctype</code> attribute set to "<code>multipart/form-data</code>" (the same as <a href="https://stackoverflow.com/questions/2422468/how-can-i-upload-files-to-a-server-using-jsp-servlet/2424824#2424824">BalusC's answer</a>):</p>
     <pre class="lang-html prettyprint-override"><code>&lt;form action="upload" method="post" enctype="multipart/form-data"&gt;
    &lt;input type="file" name="file" /&gt;
    &lt;input type="submit" value="Upload"/&gt;
&lt;/form&gt;
</code></pre>
     <p>In your controller, map the request parameter <code>file</code> to <code>MultipartFile</code> type as follows:</p>
     <pre><code>@RequestMapping(value = "/upload", method = RequestMethod.POST)
public void handleUpload(@RequestParam("file") MultipartFile file) throws IOException {
    if (!file.isEmpty()) {
            byte[] bytes = file.getBytes(); // alternatively, file.getInputStream();
            // application logic
    }
}
</code></pre>
     <p>You can get the filename and size using <code>MultipartFile</code>'s <code>getOriginalFilename()</code> and <code>getSize()</code>.</p>
     <p>I've tested this with Spring version <code>4.1.1.RELEASE</code>.</p>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>If I'm not mistaken, this requires that you configure a bean in your server's application config...</span> <span> - </span> <span class="display-name">Kenny Worden</span> <span> </span> <span class="date">19 Jul 2018 at 21:36</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_3"><span>Answer 3</span> <span class="arrow"> <a href="#answer_2">↑</a> </span> <span class="arrow"> <a href="#answer_4">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>12</span>
     </div>
     <div>
      <span>Answerer: </span> <span>joseluisbz</span>
     </div>
     <div>
      <span> Answered: </span> <span>25 Jan 2014 at 05:44</span>
     </div>
    </div>
    <div>
     <p><strong>Without components or external libraries in Tomcat 6 or Tomcat 7</strong></p>
     <p>Enabling upload in the <strong>web.xml</strong> file:</p>
     <p><em><a href="http://joseluisbz.wordpress.com/2014/01/17/manually-installing-php-tomcat-and-httpd-lounge/#Enabling%20File%20Uploads" rel="nofollow noreferrer">Manually Installing PHP, Tomcat and Httpd Lounge</a></em>.</p>
     <pre class="lang-xml prettyprint-override"><code>&lt;servlet&gt;
    &lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.apache.jasper.servlet.JspServlet&lt;/servlet-class&gt;
    &lt;multipart-config&gt;
      &lt;max-file-size&gt;3145728&lt;/max-file-size&gt;
      &lt;max-request-size&gt;5242880&lt;/max-request-size&gt;
    &lt;/multipart-config&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;fork&lt;/param-name&gt;
        &lt;param-value&gt;false&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;xpoweredBy&lt;/param-name&gt;
        &lt;param-value&gt;false&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;3&lt;/load-on-startup&gt;
&lt;/servlet&gt;
</code></pre>
     <p><em>As you can see</em>:</p>
     <pre class="lang-xml prettyprint-override"><code>&lt;multipart-config&gt;
  &lt;max-file-size&gt;3145728&lt;/max-file-size&gt;
  &lt;max-request-size&gt;5242880&lt;/max-request-size&gt;
&lt;/multipart-config&gt;
</code></pre>
     <p><strong>Uploading files using JSP. files:</strong></p>
     <p><em>In the HTML file</em></p>
     <pre><code>&lt;form method="post" enctype="multipart/form-data" name="Form" &gt;

  &lt;input type="file" name="fFoto" id="fFoto" value="" /&gt;&lt;/td&gt;
  &lt;input type="file" name="fResumen" id="fResumen" value=""/&gt;
</code></pre>
     <p><em>In the JSP File</em> or <em>Servlet</em></p>
     <pre><code>InputStream isFoto = request.getPart("fFoto").getInputStream();
InputStream isResu = request.getPart("fResumen").getInputStream();
ByteArrayOutputStream baos = new ByteArrayOutputStream();
byte buf[] = new byte[8192];
int qt = 0;
while ((qt = isResu.read(buf)) != -1) {
  baos.write(buf, 0, qt);
}
String sResumen = baos.toString();
</code></pre>
     <p>Edit your code to servlet requirements, like <em>max-file-size</em>, <em>max-request-size</em> and other options that you can to set...</p>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_4"><span>Answer 4</span> <span class="arrow"> <a href="#answer_3">↑</a> </span> <span class="arrow"> <a href="#answer_5">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>10</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Pranav</span>
     </div>
     <div>
      <span> Answered: </span> <span>17 May 2012 at 11:11</span>
     </div>
    </div>
    <div>
     <p>You need the <code>common-io.1.4.jar</code> file to be included in your <code>lib</code> directory, or if you're working in any editor, like NetBeans, then you need to go to project properties and just add the JAR file and you will be done.</p>
     <p>To get the <code>common.io.jar</code> file just google it or just go to the Apache <a href="http://en.wikipedia.org/wiki/Apache_Tomcat">Tomcat</a> website where you get the option for a free download of this file. But remember one thing: download the binary ZIP file if you're a Windows user.</p>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>Can't find <code>.jar</code> but <code>.zip</code>. Do you mean <code>.zip</code>?</span> <span> - </span> <span class="display-name">Malwinder Singh</span> <span> </span> <span class="date">9 Oct 2014 at 11:42</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_5"><span>Answer 5</span> <span class="arrow"> <a href="#answer_4">↑</a> </span> <span class="arrow"> <a href="#answer_6">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>9</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Nagappa L M</span>
     </div>
     <div>
      <span> Answered: </span> <span>8 Jan 2013 at 05:50</span>
     </div>
    </div>
    <div>
     <p>I am using a common Servlet for <strong>every</strong> HTML form whether it has attachments or not.</p>
     <p>This Servlet returns a <code>TreeMap</code> where the keys are JSP name parameters and values are user inputs and saves all attachments in a fixed directory and later you rename the directory of your choice. Here <em>Connections</em> is our custom interface having a connection object.</p>
     <pre><code>public class ServletCommonfunctions extends HttpServlet implements
        Connections {

    private static final long serialVersionUID = 1L;

    public ServletCommonfunctions() {}

    protected void doPost(HttpServletRequest request,
                          HttpServletResponse response) throws ServletException,
                          IOException {}

    public SortedMap&lt;String, String&gt; savefilesindirectory(
            HttpServletRequest request, HttpServletResponse response)
            throws IOException {

        // Map&lt;String, String&gt; key_values = Collections.synchronizedMap(new
        // TreeMap&lt;String, String&gt;());
        SortedMap&lt;String, String&gt; key_values = new TreeMap&lt;String, String&gt;();
        String dist = null, fact = null;
        PrintWriter out = response.getWriter();
        File file;
        String filePath = "E:\\FSPATH1\\2KL06CS048\\";
        System.out.println("Directory Created   ????????????"
            + new File(filePath).mkdir());
        int maxFileSize = 5000 * 1024;
        int maxMemSize = 5000 * 1024;

        // Verify the content type
        String contentType = request.getContentType();
        if ((contentType.indexOf("multipart/form-data") &gt;= 0)) {
            DiskFileItemFactory factory = new DiskFileItemFactory();
            // Maximum size that will be stored in memory
            factory.setSizeThreshold(maxMemSize);
            // Location to save data that is larger than maxMemSize.
            factory.setRepository(new File(filePath));
            // Create a new file upload handler
            ServletFileUpload upload = new ServletFileUpload(factory);
            // maximum file size to be uploaded.
            upload.setSizeMax(maxFileSize);
            try {
                // Parse the request to get file items.
                @SuppressWarnings("unchecked")
                List&lt;FileItem&gt; fileItems = upload.parseRequest(request);
                // Process the uploaded file items
                Iterator&lt;FileItem&gt; i = fileItems.iterator();
                while (i.hasNext()) {
                    FileItem fi = (FileItem) i.next();
                    if (!fi.isFormField()) {
                        // Get the uploaded file parameters
                        String fileName = fi.getName();
                        // Write the file
                        if (fileName.lastIndexOf("\\") &gt;= 0) {
                            file = new File(filePath
                                + fileName.substring(fileName
                                        .lastIndexOf("\\")));
                        } else {
                            file = new File(filePath
                                + fileName.substring(fileName
                                        .lastIndexOf("\\") + 1));
                        }
                        fi.write(file);
                    } else {
                        key_values.put(fi.getFieldName(), fi.getString());
                    }
                }
            } catch (Exception ex) {
                System.out.println(ex);
            }
        }
        return key_values;
    }
}
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>@buhake sindi hey what should be the filepath if i m using live server or i live my project by uploading files to the server</span> <span> - </span> <span class="display-name">AmanS</span> <span> </span> <span class="date">20 Oct 2013 at 04:00</span></td>
       </tr>
       <tr>
        <td>2</td>
        <td><span>Any directory in live server.if you write a code to create a directory in servlet then directory will be created in live srver</span> <span> - </span> <span class="display-name">Nagappa L M</span> <span> </span> <span class="date">20 Oct 2013 at 09:27</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_6"><span>Answer 6</span> <span class="arrow"> <a href="#answer_5">↑</a> </span> <span class="arrow"> <a href="#answer_7">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>7</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Shivangi Gupta</span>
     </div>
     <div>
      <span> Answered: </span> <span>15 Jul 2017 at 19:42</span>
     </div>
    </div>
    <div>
     <p><strong>For Spring MVC</strong></p>
     <p>I managed to have a simpler version that worked for taking form input, both data and images.</p>
     <pre class="lang-html prettyprint-override"><code>&lt;form action="/handleform" method="post" enctype="multipart/form-data"&gt;
    &lt;input type="text" name="name" /&gt;
    &lt;input type="text" name="age" /&gt;
    &lt;input type="file" name="file" /&gt;
    &lt;input type="submit" /&gt;
&lt;/form&gt;
</code></pre>
     <h3>Controller to handle</h3>
     <pre><code>@Controller
public class FormController {
    @RequestMapping(value="/handleform",method= RequestMethod.POST)
    ModelAndView register(@RequestParam String name, @RequestParam int age, @RequestParam MultipartFile file)
            throws ServletException, IOException {

        System.out.println(name);
        System.out.println(age);
        if(!file.isEmpty()){
            byte[] bytes = file.getBytes();
            String filename = file.getOriginalFilename();
            BufferedOutputStream stream =new BufferedOutputStream(new FileOutputStream(new File("D:/" + filename)));
            stream.write(bytes);
            stream.flush();
            stream.close();
        }
        return new ModelAndView("index");
    }
}
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>Can you please share select image form db mysql and show it on jsp/html?</span> <span> - </span> <span class="display-name">Onic Team</span> <span> </span> <span class="date">13 Mar 2019 at 12:27</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_7"><span>Answer 7</span> <span class="arrow"> <a href="#answer_6">↑</a> </span> <span class="arrow"> <a href="#answer_8">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>6</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Geoffrey Malafsky</span>
     </div>
     <div>
      <span> Answered: </span> <span>10 Sep 2013 at 15:15</span>
     </div>
    </div>
    <div>
     <p>Another source of this problem occurs if you are using <a href="https://en.wikipedia.org/wiki/Apache_Geronimo" rel="nofollow noreferrer">Geronimo</a> with its embedded Tomcat. In this case, after many iterations of testing <a href="https://commons.apache.org/proper/commons-io/" rel="nofollow noreferrer">Commons IO</a> and commons-fileupload, the problem arises from a parent classloader handling the commons-xxx JAR files. This has to be prevented. The crash always occurred at:</p>
     <pre><code>fileItems = uploader.parseRequest(request);
</code></pre>
     <p>Note that the List type of fileItems has changed with the current version of commons-fileupload to be specifically <code>List&lt;FileItem&gt;</code> as opposed to prior versions where it was generic <code>List</code>.</p>
     <p>I added the source code for commons-fileupload and Commons IO into my <a href="https://en.wikipedia.org/wiki/Eclipse_%28software%29" rel="nofollow noreferrer">Eclipse</a> project to trace the actual error and finally got some insight. First, the exception thrown is of type Throwable not the stated FileIOException nor even Exception (these will not be trapped). Second, the error message is obfuscatory in that it stated class not found because axis2 could not find commons-io. Axis2 is not used in my project at all, but it exists as a folder in the Geronimo repository subdirectory as part of standard installation.</p>
     <p>Finally, I found one place that posed a working solution which successfully solved my problem. You must hide the JAR files from the parent loader in the deployment plan. This was put into the <em>geronimo-web.xml</em> file with my full file shown below.</p>
     <p>Pasted from <em><a href="http://osdir.com/ml/user-geronimo-apache/2011-03/msg00026.html" rel="nofollow noreferrer">http://osdir.com/ml/user-geronimo-apache/2011-03/msg00026.html</a></em>:</p>
     <pre class="lang-xml prettyprint-override"><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;web:web-app xmlns:app="http://geronimo.apache.org/xml/ns/j2ee/application-2.0" xmlns:client="http://geronimo.apache.org/xml/ns/j2ee/application-client-2.0" xmlns:conn="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2" xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2" xmlns:ejb="http://openejb.apache.org/xml/ns/openejb-jar-2.2" xmlns:log="http://geronimo.apache.org/xml/ns/loginconfig-2.0" xmlns:name="http://geronimo.apache.org/xml/ns/naming-1.2" xmlns:pers="http://java.sun.com/xml/ns/persistence" xmlns:pkgen="http://openejb.apache.org/xml/ns/pkgen-2.1" xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" xmlns:web="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1"&gt;
    &lt;dep:environment&gt;
        &lt;dep:moduleId&gt;
            &lt;dep:groupId&gt;DataStar&lt;/dep:groupId&gt;
            &lt;dep:artifactId&gt;DataStar&lt;/dep:artifactId&gt;
            &lt;dep:version&gt;1.0&lt;/dep:version&gt;
            &lt;dep:type&gt;car&lt;/dep:type&gt;
        &lt;/dep:moduleId&gt;

        &lt;!-- Don't load commons-io or fileupload from parent classloaders --&gt;
        &lt;dep:hidden-classes&gt;
            &lt;dep:filter&gt;org.apache.commons.io&lt;/dep:filter&gt;
            &lt;dep:filter&gt;org.apache.commons.fileupload&lt;/dep:filter&gt;
        &lt;/dep:hidden-classes&gt;
        &lt;dep:inverse-classloading/&gt;

    &lt;/dep:environment&gt;
    &lt;web:context-root&gt;/DataStar&lt;/web:context-root&gt;
&lt;/web:web-app&gt;
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>The link is (effectively) broken (redirects to <code>https://osdir.com/</code>) - the HTTPS version does as well.</span> <span> - </span> <span class="display-name">Peter Mortensen</span> <span> </span> <span class="date">27 Oct 2021 at 20:17</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_8"><span>Answer 8</span> <span class="arrow"> <a href="#answer_7">↑</a> </span> <span class="arrow"> <a href="#answer_9">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>0</span>
     </div>
     <div>
      <span>Answerer: </span> <span>dessalines</span>
     </div>
     <div>
      <span> Answered: </span> <span>21 May 2015 at 16:49</span>
     </div>
    </div>
    <div>
     <p>Here's an example using apache commons-fileupload:</p>
     <pre><code>// apache commons-fileupload to handle file upload
DiskFileItemFactory factory = new DiskFileItemFactory();
factory.setRepository(new File(DataSources.TORRENTS_DIR()));
ServletFileUpload fileUpload = new ServletFileUpload(factory);

List&lt;FileItem&gt; items = fileUpload.parseRequest(req.raw());
FileItem item = items.stream()
  .filter(e -&gt;
  "the_upload_name".equals(e.getFieldName()))
  .findFirst().get();
String fileName = item.getName();

item.write(new File(dir, fileName));
log.info(fileName);
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_9"><span>Answer 9</span> <span class="arrow"> <a href="#answer_8">↑</a> </span> <span class="arrow"> <a href="#answer_10">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>0</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Lakindu Hewawasam</span>
     </div>
     <div>
      <span> Answered: </span> <span>24 Nov 2020 at 10:49</span>
     </div>
    </div>
    <div>
     <p>You first have to set the enctype attribute of the form to "multipart/form-data"</p>
     <p>This is shown below.</p>
     <pre class="lang-html prettyprint-override"><code>&lt;form action="Controller" method="post" enctype="multipart/form-data"&gt;
     &lt;label class="file-upload"&gt; Click here to upload an Image &lt;/label&gt;
     &lt;input type="file" name="file" id="file" required&gt;
&lt;/form&gt;
</code></pre>
     <p>And then, in the Servlet "Controller" add the Annotation for a Multi-part to indicate multipart data is processed in the servlet.</p>
     <p>After doing this, retrieve the part sent through the form and then retrieve the file name (with path)of the submitted file. Use this to create a new file in the desired path and write the parts of the file to the newly created file to recreate the file.</p>
     <p>As shown below:</p>
     <pre><code>@MultipartConfig

public class Controller extends HttpServlet {

    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        insertImage(request, response);
    }

    private void addProduct(HttpServletRequest request, HttpServletResponse response) {
        Part filePart = request.getPart("file");
        String imageName = Paths.get(filePart.getSubmittedFileName()).getFileName().toString();

        String imageSavePath = "specify image path to save image"; //path to save image
        FileOutputStream outputStream = null;
        InputStream fileContent = null;

        try {
            outputStream = new FileOutputStream(new File(imageSavePath + File.separator + imageName));
            // Creating a new file with file path and the file name
            fileContent = filePart.getInputStream();
            // Getting the input stream
            int readBytes = 0;
            byte[] readArray = new byte[1024];
            // Initializing a byte array with size 1024

            while ((readBytes = fileContent.read(readArray)) != -1) {
                outputStream.write(readArray, 0, readBytes);
            } // This loop will write the contents of the byte array unitl the end to the output stream
        } catch (Exception ex) {
            System.out.println("Error Writing File: " + ex);
        } finally {
            if (outputStream != null) {
                outputStream.close();
                // Closing the output stream
            }
            if (fileContent != null) {
                fileContent.close();
                // Closing the input stream
            }
        }
    }
}
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td>1</td>
        <td><span>This solution is different. Other solution used a library to handle files where as this does tf his with no 3rd party jar files.</span> <span> - </span> <span class="display-name">Lakindu Hewawasam</span> <span> </span> <span class="date">25 Nov 2020 at 00:43</span></td>
       </tr>
       <tr>
        <td>1</td>
        <td><span>This is already covered by the currently accepted answer. Have you read it? The native API already existed since December 2009. Your way of closing the streams is by the way also legacy. Since Java 7 which was introduced in July 2011, you can use try-with-resources statement instead of fiddling with nullchecks in finally.</span> <span> - </span> <span class="display-name">BalusC</span> <span> </span> <span class="date">25 Nov 2020 at 08:57</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_10"><span>Answer 10</span> <span class="arrow"> <a href="#answer_9">↑</a> </span> <span class="arrow"> <a href="#answer_11">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>-1</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Mitul Maheshwari</span>
     </div>
     <div>
      <span> Answered: </span> <span>4 Feb 2014 at 10:00</span>
     </div>
    </div>
    <div>
     <p>You can upload a file using JSP /servlet.</p>
     <pre class="lang-html prettyprint-override"><code>&lt;form action="UploadFileServlet" method="post"&gt;
    &lt;input type="text" name="description" /&gt;
    &lt;input type="file" name="file" /&gt;
    &lt;input type="submit" /&gt;
&lt;/form&gt;
</code></pre>
     <p>On the other hand, on the server side, use the following code.</p>
     <pre><code>package com.abc..servlet;

import java.io.File;
---------
--------


/**
 * Servlet implementation class UploadFileServlet
 */
public class UploadFileServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    public UploadFileServlet() {
        super();
        // TODO Auto-generated constructor stub
    }
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // TODO Auto-generated method stub
        response.sendRedirect("../jsp/ErrorPage.jsp");
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // TODO Auto-generated method stub

        PrintWriter out = response.getWriter();
        HttpSession httpSession = request.getSession();
        String filePathUpload = (String) httpSession.getAttribute("path") != null ? httpSession.getAttribute("path").toString() : "" ;

        String path1 = filePathUpload;
        String filename = null;
        File path = null;
        FileItem item = null;


        boolean isMultipart = ServletFileUpload.isMultipartContent(request);

        if (isMultipart) {
            FileItemFactory factory = new DiskFileItemFactory();
            ServletFileUpload upload = new ServletFileUpload(factory);
            String FieldName = "";
            try {
                List items = upload.parseRequest(request);
                Iterator iterator = items.iterator();
                while (iterator.hasNext()) {
                     item = (FileItem) iterator.next();

                        if (fieldname.equals("description")) {
                            description = item.getString();
                        }
                    }
                    if (!item.isFormField()) {
                        filename = item.getName();
                        path = new File(path1 + File.separator);
                        if (!path.exists()) {
                            boolean status = path.mkdirs();
                        }
                        /* Start of code fro privilege */

                        File uploadedFile = new File(path + Filename);  // for copy file
                        item.write(uploadedFile);
                        }
                    } else {
                        f1 = item.getName();
                    }

                } // END OF WHILE
                response.sendRedirect("welcome.jsp");
            } catch (FileUploadException e) {
                e.printStackTrace();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
}
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>What do you mean by <i>"Start of code fro privilege"</i> (seems incomprehensible)? Please respond by <a href="https://stackoverflow.com/posts/21549187/edit">editing (changing) your answer</a>, not here in comments (<b><i>without</i></b> "Edit:", "Update:", or similar - the answer should appear as if it was written today).</span> <span> - </span> <span class="display-name">Peter Mortensen</span> <span> </span> <span class="date">27 Oct 2021 at 20:43</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_11"><span>Answer 11</span> <span class="arrow"> <a href="#answer_10">↑</a> </span> <span class="arrow"> <a href="#answer_12">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>-1</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Mahender Reddy Yasa</span>
     </div>
     <div>
      <span> Answered: </span> <span>23 Mar 2015 at 12:37</span>
     </div>
    </div>
    <div>
     <p>Use:</p>
     <pre><code>DiskFileUpload upload = new DiskFileUpload();
</code></pre>
     <p>From this object you have to get the file items and fields, and then you can store into the server like the following:</p>
     <pre><code>String loc = "./webapps/prjct name/server folder/" + contentid + extension;
File uploadFile = new File(loc);
item.write(uploadFile);
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_12"><span>Answer 12</span> <span class="arrow"> <a href="#answer_11">↑</a> </span> <span class="arrow"> <a href="#answer_13">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>-1</span>
     </div>
     <div>
      <span>Answerer: </span> <span>access_granted</span>
     </div>
     <div>
      <span> Answered: </span> <span>26 Apr 2020 at 05:36</span>
     </div>
    </div>
    <div>
     <p>The simplest way I could come up with for files and input controls, without a billion libraries:</p>
     <pre><code>  &lt;%
      if (request.getContentType() == null)
          return;
      // For input type=text controls
      String v_Text =
          (new BufferedReader(new InputStreamReader(request.getPart("Text1").getInputStream()))).readLine();

      // For input type=file controls
      InputStream inStr = request.getPart("File1").getInputStream();
      char charArray[] = new char[inStr.available()];
      new InputStreamReader(inStr).read(charArray);
      String contents = new String(charArray);
  %&gt;
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td></td>
        <td><span>What is <code>&lt;%</code> for? <a href="https://en.wikipedia.org/wiki/ASP.NET" rel="nofollow noreferrer">ASP.NET</a> (<a href="https://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29" rel="nofollow noreferrer">C#</a>)? Can you clarify? Please respond by <a href="https://stackoverflow.com/posts/61436277/edit">editing (changing) your answer</a>, not here in comments (<b><i>without</i></b> "Edit:", "Update:", or similar - the answer should appear as if it was written today).</span> <span> - </span> <span class="display-name">Peter Mortensen</span> <span> </span> <span class="date">27 Oct 2021 at 21:10</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_13"><span>Answer 13</span> <span class="arrow"> <a href="#answer_12">↑</a> </span> <span class="arrow"> <a href="#answer_14">↓</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>-2</span>
     </div>
     <div>
      <span>Answerer: </span> <span>Himanshu Patel</span>
     </div>
     <div>
      <span> Answered: </span> <span>15 Jul 2016 at 07:14</span>
     </div>
    </div>
    <div>
     <h3>HTML page</h3>
     <pre class="lang-html prettyprint-override"><code>&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;File Uploading Form&lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;h3&gt;File Upload:&lt;/h3&gt;
        Select a file to upload: &lt;br /&gt;
        &lt;form action="UploadServlet" method="post"
              enctype="multipart/form-data"&gt;

            &lt;input type="file" name="file" size="50" /&gt;
            &lt;br /&gt;
            &lt;input type="submit" value="Upload File" /&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
     <h3>Servlet file</h3>
     <pre><code>// Import required java libraries
import java.io.*;
import java.util.*;

import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.FileUploadException;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;
import org.apache.commons.io.output.*;

public class UploadServlet extends HttpServlet {

    private boolean isMultipart;
    private String filePath;
    private int maxFileSize = 50 * 1024;
    private int maxMemSize = 4 * 1024;
    private File file;

    public void init() {
        // Get the file location where it would be stored.
        filePath =
               getServletContext().getInitParameter("file-upload");
    }

    public void doPost(HttpServletRequest request,
                       HttpServletResponse response)
               throws ServletException, java.io.IOException {

        // Check that we have a file upload request
        isMultipart = ServletFileUpload.isMultipartContent(request);
        response.setContentType("text/html");
        java.io.PrintWriter out = response.getWriter();
        if (!isMultipart) {
            out.println("&lt;html&gt;");
            out.println("&lt;head&gt;");
            out.println("&lt;title&gt;Servlet upload&lt;/title&gt;");
            out.println("&lt;/head&gt;");
            out.println("&lt;body&gt;");
            out.println("&lt;p&gt;No file uploaded&lt;/p&gt;");
            out.println("&lt;/body&gt;");
            out.println("&lt;/html&gt;");
            return;
        }

        DiskFileItemFactory factory = new DiskFileItemFactory();
        // Maximum size that will be stored in memory
        factory.setSizeThreshold(maxMemSize);
        // Location to save data that is larger than maxMemSize.
        factory.setRepository(new File("c:\\temp"));

        // Create a new file upload handler
        ServletFileUpload upload = new ServletFileUpload(factory);
        // maximum file size to be uploaded.
        upload.setSizeMax(maxFileSize);

        try {
            // Parse the request to get file items.
            List fileItems = upload.parseRequest(request);

            // Process the uploaded file items
            Iterator i = fileItems.iterator();

            out.println("&lt;html&gt;");
            out.println("&lt;head&gt;");
            out.println("&lt;title&gt;Servlet upload&lt;/title&gt;");
            out.println("&lt;/head&gt;");
            out.println("&lt;body&gt;");
            while (i.hasNext())
            {
                FileItem fi = (FileItem)i.next();
                if (!fi.isFormField())
                {
                     // Get the uploaded file parameters
                     String fieldName = fi.getFieldName();
                     String fileName = fi.getName();
                     String contentType = fi.getContentType();
                     boolean isInMemory = fi.isInMemory();
                     long sizeInBytes = fi.getSize();

                     // Write the file
                     if (fileName.lastIndexOf("\\") &gt;= 0) {
                         file = new File(filePath +
                         fileName.substring(fileName.lastIndexOf("\\")));
                     }
                     else {
                         file = new File(filePath +
                         fileName.substring(fileName.lastIndexOf("\\") + 1));
                     }
                     fi.write(file);
                     out.println("Uploaded Filename: " + fileName + "&lt;br&gt;");
                }
            }
            out.println("&lt;/body&gt;");
            out.println("&lt;/html&gt;");
        }
        catch(Exception ex) {
            System.out.println(ex);
        }
    }

    public void doGet(HttpServletRequest request,
                        HttpServletResponse response)
            throws ServletException, java.io.IOException {

        throw new ServletException("GET method used with " +
                 getClass().getName() + ": POST method required.");
    }
}
</code></pre>
     <h3>File <em>web.xml</em></h3>
     <p>Compile the above servlet UploadServlet and create the required entry in the <em>web.xml</em> file as follows.</p>
     <pre class="lang-xml prettyprint-override"><code>&lt;servlet&gt;
   &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt;
   &lt;servlet-class&gt;UploadServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
   &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt;
   &lt;url-pattern&gt;/UploadServlet&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
     </table>
    </div>
   </div>
   <div>
    <h2 id="answer_14"><span>Answer 14</span> <span class="arrow"> <a href="#answer_13">↑</a> </span></h2>
    <div class="container-metadata">
     <div>
      <span>Score: </span> <span>-3</span>
     </div>
     <div>
      <span>Answerer: </span> <span>rohan kamat</span>
     </div>
     <div>
      <span> Answered: </span> <span>24 Oct 2013 at 09:35</span>
     </div>
    </div>
    <div>
     <p>Sending multiple files for file, we have to use <code>enctype="multipart/form-data"</code>.</p>
     <p>And to send multiple files, use <code>multiple="multiple"</code> in the <em>input</em> tag:</p>
     <pre><code>&lt;form action="upload" method="post" enctype="multipart/form-data"&gt;
    &lt;input type="file" name="fileattachments"  multiple="multiple"/&gt;
    &lt;input type="submit" /&gt;
&lt;/form&gt;
</code></pre>
    </div>
    <hr>
    <div class="comment">
     <table>
      <tbody>
       <tr>
        <td>2</td>
        <td><span>How would we go about doing getPart("fileattachments") so we get an array of Parts instead? I don't think getPart for multiple files will work?</span> <span> - </span> <span class="display-name">CyberMew</span> <span> </span> <span class="date">29 Sep 2015 at 06:38</span></td>
       </tr>
       <tr>
        <td></td>
        <td><span>What do you mean by <i>"Sending multiple files for file"</i> (seems incomprehensible)? Please respond by <a href="https://stackoverflow.com/posts/19562216/edit">editing (changing) your answer</a>, not here in comments (<b><i>without</i></b> "Edit:", "Update:", or similar - the question/answer should appear as if it was written today).</span> <span> - </span> <span class="display-name">Peter Mortensen</span> <span> </span> <span class="date">27 Oct 2021 at 20:00</span></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <br>
   <div>
    <span>License: </span> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <span>by </span> <a href="https://stackoverflow.com/legal/terms-of-service#licensing">Stack Overflow Inc.</a>
   </div>
  </div>
 </body>
</html>